{
  "version": 3,
  "sources": ["string-utils.ts"],
  "sourcesContent": ["/**\n * String Utilities - Common string manipulation functions\n * \n * Consolidated utilities used across field handlers and GPT answerer.\n * Eliminates duplication of text normalization and matching logic.\n */\n\n/**\n * Normalize text for comparison\n * - Lowercases\n * - Removes accents (NFD decomposition)\n * - Trims whitespace\n * - Collapses multiple spaces\n */\nexport function normalizeText(text: string): string {\n  return text\n    .toLowerCase()\n    .normalize('NFD')                    // Decompose accents\n    .replace(/[\\u0300-\\u036f]/g, '')    // Remove accent marks\n    .replace(/\\s+/g, ' ')               // Normalize whitespace\n    .trim();\n}\n\n/**\n * Calculate Levenshtein distance between two strings\n * Used for fuzzy matching when exact match fails\n */\nexport function levenshteinDistance(a: string, b: string): number {\n  const matrix: number[][] = [];\n\n  // Initialize first column\n  for (let i = 0; i <= b.length; i++) {\n    matrix[i] = [i];\n  }\n  \n  // Initialize first row\n  for (let j = 0; j <= a.length; j++) {\n    matrix[0][j] = j;\n  }\n\n  // Fill in the rest of the matrix\n  for (let i = 1; i <= b.length; i++) {\n    for (let j = 1; j <= a.length; j++) {\n      if (b.charAt(i - 1) === a.charAt(j - 1)) {\n        matrix[i][j] = matrix[i - 1][j - 1];\n      } else {\n        matrix[i][j] = Math.min(\n          matrix[i - 1][j - 1] + 1, // substitution\n          matrix[i][j - 1] + 1,     // insertion\n          matrix[i - 1][j] + 1      // deletion\n        );\n      }\n    }\n  }\n\n  return matrix[b.length][a.length];\n}\n\n/**\n * Find the best matching option from a list using multiple strategies\n * \n * Matching priority:\n * 1. Exact match (case-insensitive)\n * 2. Contains match\n * 3. Levenshtein distance (fuzzy match)\n * \n * @param text - The text to match\n * @param options - List of options to choose from\n * @returns The best matching option\n */\nexport function findBestMatch(text: string, options: string[]): string {\n  if (options.length === 0) return text;\n  \n  const textLower = text.toLowerCase().trim();\n  \n  // 1. Exact match (case-insensitive)\n  const exact = options.find(o => o.toLowerCase() === textLower);\n  if (exact) return exact;\n\n  // 2. Contains match (bidirectional)\n  const contains = options.find(o => \n    textLower.includes(o.toLowerCase()) || o.toLowerCase().includes(textLower)\n  );\n  if (contains) return contains;\n\n  // 3. Fuzzy match using Levenshtein distance\n  let bestOption = options[0];\n  let bestDistance = Infinity;\n\n  for (const option of options) {\n    const distance = levenshteinDistance(textLower, option.toLowerCase());\n    if (distance < bestDistance) {\n      bestDistance = distance;\n      bestOption = option;\n    }\n  }\n\n  return bestOption;\n}\n\n/**\n * Strip markdown code block wrappers from text\n * Handles both ```yaml and generic ``` blocks\n */\nexport function stripMarkdownCodeBlock(text: string): string {\n  const trimmed = text.trim();\n  if (!trimmed.startsWith('```')) return text;\n  \n  const lines = trimmed.split('\\n');\n  let startIdx = 0;\n  let endIdx = lines.length;\n  \n  for (let i = 0; i < lines.length; i++) {\n    if (lines[i].trim().startsWith('```')) {\n      if (startIdx === 0) {\n        startIdx = i + 1;\n      } else {\n        endIdx = i;\n        break;\n      }\n    }\n  }\n  \n  return lines.slice(startIdx, endIdx).join('\\n');\n}\n\n/**\n * Truncate text to max length with ellipsis\n */\nexport function truncate(text: string, maxLength: number): string {\n  if (text.length <= maxLength) return text;\n  return text.substring(0, maxLength - 3) + '...';\n}\n\n/**\n * Capitalize first letter of string\n */\nexport function capitalize(text: string): string {\n  return text.charAt(0).toUpperCase() + text.slice(1);\n}\n\n/**\n * Check if a string looks like a URL\n */\nexport function isUrl(text: string): boolean {\n  return text.startsWith('http://') || \n         text.startsWith('https://') || \n         text.includes('.com') || \n         text.includes('.io') ||\n         text.includes('.org') ||\n         text.includes('.net');\n}\n\n/**\n * Extract numbers from a string\n * Returns the first number found, or null if none\n */\nexport function extractNumber(text: string): number | null {\n  const match = text.match(/\\d+/);\n  return match ? parseInt(match[0], 10) : null;\n}\n"],
  "mappings": "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",
  "names": []
}
