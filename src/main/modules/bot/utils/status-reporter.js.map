{
  "version": 3,
  "sources": ["status-reporter.ts"],
  "sourcesContent": ["/**\n * Status Reporter - Direct IPC communication with Electron renderer\n * \n * Replaces the Python stdout-based IPC with direct Electron IPC.\n * Sends status updates to the renderer process in real-time.\n * \n * PAYLOAD FORMAT (must match useBot.ts expectations):\n * {\n *   stage: 'checking' | 'installing' | 'launching' | 'running' | 'completed' | 'failed' | 'stopped',\n *   message?: string,\n *   activity?: string,\n *   details?: Record<string, unknown>,\n *   stats?: { jobs_found, jobs_applied, jobs_failed, credits_used }  // snake_case!\n * }\n */\n\nimport { BrowserWindow } from 'electron';\nimport type { BotStats, BotActivity } from '../types';\nimport { createLogger } from './logger';\n\nconst log = createLogger('StatusReporter');\n\n// Stage type matching frontend expectations\ntype BotStage = 'checking' | 'installing' | 'launching' | 'running' | 'completed' | 'failed' | 'stopped';\n\n// Payload format matching useBot.ts expectations (snake_case stats)\ninterface StatusPayload {\n  stage: BotStage;\n  message?: string;\n  activity?: string;\n  details?: Record<string, unknown>;\n  stats?: {\n    jobs_found: number;\n    jobs_applied: number;\n    jobs_failed: number;\n    credits_used: number;\n  };\n}\n\nexport class StatusReporter {\n  private mainWindow: BrowserWindow | null = null;\n  private stopped = false;\n  private stats: BotStats = {\n    jobsFound: 0,\n    jobsApplied: 0,\n    jobsFailed: 0,\n    creditsUsed: 0,\n  };\n\n  /**\n   * Set the main window for IPC communication\n   */\n  setMainWindow(window: BrowserWindow): void {\n    this.mainWindow = window;\n    log.debug('Main window set for IPC');\n  }\n\n  /**\n   * Convert internal camelCase stats to snake_case for frontend\n   */\n  private getSnakeCaseStats() {\n    return {\n      jobs_found: this.stats.jobsFound,\n      jobs_applied: this.stats.jobsApplied,\n      jobs_failed: this.stats.jobsFailed,\n      credits_used: this.stats.creditsUsed,\n    };\n  }\n\n  /**\n   * Emit a status message to the renderer\n   * Uses the format expected by useBot.ts\n   */\n  private emit(payload: StatusPayload): void {\n    if (!this.mainWindow || this.mainWindow.isDestroyed()) {\n      log.warn('Cannot emit status - no main window');\n      return;\n    }\n\n    try {\n      this.mainWindow.webContents.send('bot-status', payload);\n      log.debug(`Emitted: stage=${payload.stage} activity=${payload.activity || ''}`);\n    } catch (error) {\n      log.error('Failed to emit status', error as Error);\n    }\n  }\n\n  /**\n   * Signal session start\n   */\n  startSession(botVersion: string, platform: string): void {\n    log.info(`Starting session - v${botVersion} on ${platform}`);\n    this.stopped = false;\n    this.stats = { jobsFound: 0, jobsApplied: 0, jobsFailed: 0, creditsUsed: 0 };\n    \n    this.emit({\n      stage: 'running',\n      message: 'Bot session started',\n      activity: 'initializing',\n      details: { botVersion, platform },\n      stats: this.getSnakeCaseStats(),\n    });\n  }\n\n  /**\n   * Send a heartbeat with current activity\n   * Returns false if the session was stopped\n   */\n  sendHeartbeat(activity: BotActivity, details?: Record<string, unknown>): boolean {\n    if (this.stopped) {\n      log.debug('Skipping heartbeat - session stopped');\n      return false;\n    }\n\n    this.emit({\n      stage: 'running',\n      activity,\n      details,\n      stats: this.getSnakeCaseStats(),\n    });\n\n    return true;\n  }\n\n  /**\n   * Signal session completion\n   */\n  completeSession(success: boolean, errorMessage?: string): void {\n    log.info(`Session complete: ${success ? 'success' : 'failed'}`);\n    \n    this.emit({\n      stage: success ? 'completed' : 'failed',\n      message: errorMessage || (success ? 'Session completed successfully' : 'Session failed'),\n      stats: this.getSnakeCaseStats(),\n    });\n  }\n\n  /**\n   * Mark session as stopped (called on SIGTERM or user stop)\n   */\n  markStopped(): void {\n    this.stopped = true;\n    log.info('Session marked as stopped');\n    \n    this.emit({\n      stage: 'stopped',\n      message: 'User requested stop',\n      details: { reason: 'User requested stop' },\n      stats: this.getSnakeCaseStats(),\n    });\n  }\n\n  /**\n   * Check if session was stopped\n   */\n  isStopped(): boolean {\n    return this.stopped;\n  }\n\n  // =========================================================================\n  // Statistics Methods\n  // =========================================================================\n\n  /**\n   * Emit a stats-only update to keep UI in sync\n   * Called after each stat increment for real-time updates\n   */\n  private emitStatsUpdate(): void {\n    if (this.stopped) return;\n    \n    this.emit({\n      stage: 'running',\n      activity: 'stats_update',\n      stats: this.getSnakeCaseStats(),\n    });\n  }\n\n  incrementJobsFound(count = 1): void {\n    this.stats.jobsFound += count;\n    log.debug(`Jobs found: +${count} (total: ${this.stats.jobsFound})`);\n    this.emitStatsUpdate();\n  }\n\n  incrementJobsApplied(count = 1): void {\n    this.stats.jobsApplied += count;\n    log.debug(`Jobs applied: +${count} (total: ${this.stats.jobsApplied})`);\n    this.emitStatsUpdate();\n  }\n\n  incrementJobsFailed(count = 1): void {\n    this.stats.jobsFailed += count;\n    log.debug(`Jobs failed: +${count} (total: ${this.stats.jobsFailed})`);\n    this.emitStatsUpdate();\n  }\n\n  incrementCreditsUsed(count = 1): void {\n    this.stats.creditsUsed += count;\n    log.debug(`Credits used: +${count} (total: ${this.stats.creditsUsed})`);\n    this.emitStatsUpdate();\n  }\n\n  getStats(): BotStats {\n    return { ...this.stats };\n  }\n}\n\n// Singleton instance\nexport const statusReporter = new StatusReporter();\n"],
  "mappings": "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",
  "names": []
}
