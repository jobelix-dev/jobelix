{
  "version": 3,
  "sources": ["debug-html.ts"],
  "sourcesContent": ["/**\n * Debug HTML Utility - Saves HTML snapshots for debugging\n * \n * Centralized utility for saving page HTML snapshots during bot execution.\n * Used for debugging failed applications and understanding page states.\n */\n\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport type { Page } from 'playwright-core';\nimport { getDebugHtmlPath } from './paths';\nimport { createLogger } from './logger';\n\nconst log = createLogger('DebugHtml');\n\n/**\n * Save a debug HTML snapshot of the current page state\n * \n * @param page - Playwright page instance\n * @param context - Description of what's happening (e.g., 'modal_opened', 'button_not_found')\n * @param jobTitle - Optional job title for the filename\n * @returns Path to saved file, or null if save failed\n */\nexport async function saveDebugHtml(\n  page: Page,\n  context: string,\n  jobTitle: string = ''\n): Promise<string | null> {\n  try {\n    const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, 19);\n    const safeTitle = jobTitle\n      .replace(/\\s+/g, '_')\n      .replace(/[/\\\\]/g, '_')\n      .slice(0, 50);\n    \n    const filename = safeTitle \n      ? `${context}_${safeTitle}_${timestamp}.html`\n      : `${context}_${timestamp}.html`;\n    \n    const debugDir = getDebugHtmlPath();\n    \n    // Ensure debug directory exists\n    if (!fs.existsSync(debugDir)) {\n      fs.mkdirSync(debugDir, { recursive: true });\n    }\n    \n    const filepath = path.join(debugDir, filename);\n    const htmlContent = await page.content();\n    const url = page.url();\n    \n    // Add metadata header for debugging\n    const fullContent = `<!-- Debug HTML Snapshot -->\n<!-- Context: ${context} -->\n<!-- Job Title: ${jobTitle || 'N/A'} -->\n<!-- URL: ${url} -->\n<!-- Timestamp: ${new Date().toISOString()} -->\n\n${htmlContent}`;\n    \n    fs.writeFileSync(filepath, fullContent, 'utf-8');\n    log.info(`\uD83D\uDCF8 Saved: ${filepath}`);\n    return filepath;\n  } catch (error) {\n    log.error(`Failed to save debug HTML: ${error}`);\n    return null;\n  }\n}\n\n/**\n * Clean up old debug HTML files (older than specified days)\n * \n * @param maxAgeDays - Maximum age of files to keep (default: 7 days)\n */\nexport function cleanupOldDebugFiles(maxAgeDays: number = 7): void {\n  try {\n    const debugDir = getDebugHtmlPath();\n    if (!fs.existsSync(debugDir)) return;\n\n    const maxAgeMs = maxAgeDays * 24 * 60 * 60 * 1000;\n    const now = Date.now();\n    \n    const files = fs.readdirSync(debugDir);\n    let cleaned = 0;\n    \n    for (const file of files) {\n      const filepath = path.join(debugDir, file);\n      const stat = fs.statSync(filepath);\n      \n      if (now - stat.mtimeMs > maxAgeMs) {\n        fs.unlinkSync(filepath);\n        cleaned++;\n      }\n    }\n    \n    if (cleaned > 0) {\n      log.info(`Cleaned up ${cleaned} old debug HTML files`);\n    }\n  } catch (error) {\n    log.warn(`Failed to cleanup debug files: ${error}`);\n  }\n}\n"],
  "mappings": "AAOA,YAAY,QAAQ;AACpB,YAAY,UAAU;AAEtB,SAAS,wBAAwB;AACjC,SAAS,oBAAoB;AAE7B,MAAM,MAAM,aAAa,WAAW;AAUpC,eAAsB,cACpB,MACA,SACA,WAAmB,IACK;AACxB,MAAI;AACF,UAAM,aAAY,oBAAI,KAAK,GAAE,YAAY,EAAE,QAAQ,SAAS,GAAG,EAAE,MAAM,GAAG,EAAE;AAC5E,UAAM,YAAY,SACf,QAAQ,QAAQ,GAAG,EACnB,QAAQ,UAAU,GAAG,EACrB,MAAM,GAAG,EAAE;AAEd,UAAM,WAAW,YACb,GAAG,OAAO,IAAI,SAAS,IAAI,SAAS,UACpC,GAAG,OAAO,IAAI,SAAS;AAE3B,UAAM,WAAW,iBAAiB;AAGlC,QAAI,CAAC,GAAG,WAAW,QAAQ,GAAG;AAC5B,SAAG,UAAU,UAAU,EAAE,WAAW,KAAK,CAAC;AAAA,IAC5C;AAEA,UAAM,WAAW,KAAK,KAAK,UAAU,QAAQ;AAC7C,UAAM,cAAc,MAAM,KAAK,QAAQ;AACvC,UAAM,MAAM,KAAK,IAAI;AAGrB,UAAM,cAAc;AAAA,gBACR,OAAO;AAAA,kBACL,YAAY,KAAK;AAAA,YACvB,GAAG;AAAA,mBACG,oBAAI,KAAK,GAAE,YAAY,CAAC;AAAA;AAAA,EAExC,WAAW;AAET,OAAG,cAAc,UAAU,aAAa,OAAO;AAC/C,QAAI,KAAK,oBAAa,QAAQ,EAAE;AAChC,WAAO;AAAA,EACT,SAAS,OAAO;AACd,QAAI,MAAM,8BAA8B,KAAK,EAAE;AAC/C,WAAO;AAAA,EACT;AACF;AAOO,SAAS,qBAAqB,aAAqB,GAAS;AACjE,MAAI;AACF,UAAM,WAAW,iBAAiB;AAClC,QAAI,CAAC,GAAG,WAAW,QAAQ,EAAG;AAE9B,UAAM,WAAW,aAAa,KAAK,KAAK,KAAK;AAC7C,UAAM,MAAM,KAAK,IAAI;AAErB,UAAM,QAAQ,GAAG,YAAY,QAAQ;AACrC,QAAI,UAAU;AAEd,eAAW,QAAQ,OAAO;AACxB,YAAM,WAAW,KAAK,KAAK,UAAU,IAAI;AACzC,YAAM,OAAO,GAAG,SAAS,QAAQ;AAEjC,UAAI,MAAM,KAAK,UAAU,UAAU;AACjC,WAAG,WAAW,QAAQ;AACtB;AAAA,MACF;AAAA,IACF;AAEA,QAAI,UAAU,GAAG;AACf,UAAI,KAAK,cAAc,OAAO,uBAAuB;AAAA,IACvD;AAAA,EACF,SAAS,OAAO;AACd,QAAI,KAAK,kCAAkC,KAAK,EAAE;AAAA,EACpD;AACF;",
  "names": []
}
