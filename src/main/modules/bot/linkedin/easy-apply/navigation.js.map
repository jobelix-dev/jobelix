{
  "version": 3,
  "sources": ["navigation.ts"],
  "sourcesContent": ["/**\n * Navigation Handler - Manages Easy Apply modal navigation\n * \n * Handles all navigation within the LinkedIn Easy Apply modal:\n * - Next button clicking\n * - Review button clicking\n * - Submit button clicking\n * - Back button for error recovery\n * - Modal dismissal\n * - Error detection\n */\n\nimport type { Page, Locator } from 'playwright';\nimport { createLogger } from '../../utils/logger';\n\nconst log = createLogger('Navigation');\n\n/**\n * Possible states of the Easy Apply modal\n */\nexport type ModalState = \n  | 'form'        // Regular form page with Next button\n  | 'review'      // Review page before submission\n  | 'submit'      // Final submit button visible\n  | 'success'     // Application submitted successfully\n  | 'error'       // Error occurred\n  | 'closed'      // Modal was closed\n  | 'unknown';    // Unable to determine state\n\n/**\n * Navigation result after an action\n */\nexport interface NavigationResult {\n  success: boolean;\n  state: ModalState;\n  error?: string;\n}\n\nexport class NavigationHandler {\n  private page: Page;\n\n  constructor(page: Page) {\n    this.page = page;\n  }\n\n  /**\n   * Get the current state of the Easy Apply modal\n   * \n   * This determines what navigation buttons are available\n   * and what action should be taken next.\n   */\n  async getModalState(): Promise<ModalState> {\n    try {\n      // Check if modal is still open\n      const modal = this.page.locator('[data-test-modal]').first();\n      if (await modal.count() === 0) {\n        return 'closed';\n      }\n\n      // Check for success message\n      const successIndicators = [\n        'text=/application.*sent/i',\n        'text=/successfully.*applied/i',\n        '[data-test-modal-close-btn]', // Success modal has close button\n      ];\n      \n      for (const selector of successIndicators) {\n        const element = this.page.locator(selector).first();\n        if (await element.count() > 0) {\n          const text = await modal.textContent() || '';\n          if (text.toLowerCase().includes('application') && \n              (text.toLowerCase().includes('sent') || text.toLowerCase().includes('submitted'))) {\n            return 'success';\n          }\n        }\n      }\n\n      // Check for Submit button (final step)\n      const submitButton = this.page.locator('button[aria-label*=\"Submit application\"]');\n      if (await submitButton.count() > 0 && await submitButton.isVisible()) {\n        return 'submit';\n      }\n\n      // Check for Review button (one step before submit)\n      const reviewButton = this.page.locator('button[aria-label*=\"Review\"]');\n      if (await reviewButton.count() > 0 && await reviewButton.isVisible()) {\n        return 'review';\n      }\n\n      // Check for Next button (regular form pages)\n      const nextButton = this.page.locator('button[aria-label*=\"Continue to next step\"]');\n      if (await nextButton.count() > 0 && await nextButton.isVisible()) {\n        return 'form';\n      }\n\n      // Check for error state\n      const errorMessage = this.page.locator('.artdeco-inline-feedback--error');\n      if (await errorMessage.count() > 0) {\n        return 'error';\n      }\n\n      return 'unknown';\n    } catch (error) {\n      log.error(`Error getting modal state: ${error}`);\n      return 'unknown';\n    }\n  }\n\n  /**\n   * Click the Next button to go to the next form page\n   * \n   * @returns Navigation result with new state\n   */\n  async clickNext(): Promise<NavigationResult> {\n    try {\n      // Find Next button - LinkedIn uses various labels\n      const nextSelectors = [\n        'button[aria-label*=\"Continue to next step\"]',\n        'button[data-easy-apply-next-button]',\n        'button:has-text(\"Next\")',\n        'button:has-text(\"Continue\")',\n      ];\n\n      let nextButton: Locator | null = null;\n      for (const selector of nextSelectors) {\n        const btn = this.page.locator(selector).first();\n        if (await btn.count() > 0 && await btn.isEnabled()) {\n          nextButton = btn;\n          break;\n        }\n      }\n\n      if (!nextButton) {\n        log.debug('No Next button found');\n        return { success: false, state: await this.getModalState(), error: 'No Next button found' };\n      }\n\n      // Click and wait for navigation\n      await nextButton.click();\n      await this.page.waitForTimeout(1000);\n\n      // Check for validation errors\n      const hasErrors = await this.hasValidationErrors();\n      if (hasErrors) {\n        log.warn('Validation errors detected after clicking Next');\n        return { success: false, state: 'error', error: 'Validation errors' };\n      }\n\n      const newState = await this.getModalState();\n      log.debug(`Clicked Next \u2192 state: ${newState}`);\n      return { success: true, state: newState };\n\n    } catch (error) {\n      log.error(`Error clicking Next: ${error}`);\n      return { success: false, state: 'error', error: String(error) };\n    }\n  }\n\n  /**\n   * Click the Review button\n   */\n  async clickReview(): Promise<NavigationResult> {\n    try {\n      const reviewButton = this.page.locator('button[aria-label*=\"Review\"]').first();\n      \n      if (await reviewButton.count() === 0 || !(await reviewButton.isEnabled())) {\n        log.debug('No Review button found');\n        return { success: false, state: await this.getModalState(), error: 'No Review button' };\n      }\n\n      await reviewButton.click();\n      await this.page.waitForTimeout(1000);\n\n      const newState = await this.getModalState();\n      log.debug(`Clicked Review \u2192 state: ${newState}`);\n      return { success: true, state: newState };\n\n    } catch (error) {\n      log.error(`Error clicking Review: ${error}`);\n      return { success: false, state: 'error', error: String(error) };\n    }\n  }\n\n  /**\n   * Click the Submit button to finalize the application\n   * \n   * This is the final action - after this, the application is submitted.\n   */\n  async clickSubmit(): Promise<NavigationResult> {\n    try {\n      const submitButton = this.page.locator('button[aria-label*=\"Submit application\"]').first();\n      \n      if (await submitButton.count() === 0 || !(await submitButton.isEnabled())) {\n        log.debug('No Submit button found');\n        return { success: false, state: await this.getModalState(), error: 'No Submit button' };\n      }\n\n      // Final confirmation log\n      log.info('\uD83D\uDE80 Submitting application...');\n      \n      await submitButton.click();\n      await this.page.waitForTimeout(2000);\n\n      // Check for success\n      const newState = await this.getModalState();\n      \n      if (newState === 'success') {\n        log.info('\u2705 Application submitted successfully!');\n        return { success: true, state: 'success' };\n      } else {\n        log.warn(`Submit clicked but state is: ${newState}`);\n        return { success: false, state: newState, error: 'Submission may have failed' };\n      }\n\n    } catch (error) {\n      log.error(`Error clicking Submit: ${error}`);\n      return { success: false, state: 'error', error: String(error) };\n    }\n  }\n\n  /**\n   * Click the Back button to return to previous page\n   * \n   * Useful for error recovery.\n   */\n  async clickBack(): Promise<NavigationResult> {\n    try {\n      const backButton = this.page.locator('button[aria-label*=\"Back\"]').first();\n      \n      if (await backButton.count() === 0) {\n        return { success: false, state: await this.getModalState(), error: 'No Back button' };\n      }\n\n      await backButton.click();\n      await this.page.waitForTimeout(500);\n\n      const newState = await this.getModalState();\n      log.debug(`Clicked Back \u2192 state: ${newState}`);\n      return { success: true, state: newState };\n\n    } catch (error) {\n      log.error(`Error clicking Back: ${error}`);\n      return { success: false, state: 'error', error: String(error) };\n    }\n  }\n\n  /**\n   * Close the Easy Apply modal\n   * \n   * Used when aborting an application or after success.\n   */\n  async closeModal(): Promise<boolean> {\n    try {\n      // Try X button first\n      const closeButton = this.page.locator('button[aria-label*=\"Dismiss\"]').first();\n      if (await closeButton.count() > 0) {\n        await closeButton.click();\n        await this.page.waitForTimeout(500);\n        \n        // Handle \"Discard\" confirmation if it appears\n        await this.handleDiscardConfirmation();\n        \n        return true;\n      }\n\n      // Try pressing Escape\n      await this.page.keyboard.press('Escape');\n      await this.page.waitForTimeout(500);\n      await this.handleDiscardConfirmation();\n\n      return true;\n    } catch (error) {\n      log.error(`Error closing modal: ${error}`);\n      return false;\n    }\n  }\n\n  /**\n   * Handle the \"Discard\" confirmation dialog\n   * \n   * When closing an in-progress application, LinkedIn asks to confirm.\n   */\n  private async handleDiscardConfirmation(): Promise<void> {\n    try {\n      // Look for discard confirmation\n      const discardButton = this.page.locator('button[data-test-dialog-primary-btn]');\n      if (await discardButton.count() > 0) {\n        const buttonText = await discardButton.textContent();\n        if (buttonText?.toLowerCase().includes('discard')) {\n          await discardButton.click();\n          await this.page.waitForTimeout(500);\n          log.debug('Clicked Discard in confirmation dialog');\n        }\n      }\n    } catch {\n      // Ignore - confirmation might not appear\n    }\n  }\n\n  /**\n   * Check if there are validation errors on the current page\n   */\n  async hasValidationErrors(): Promise<boolean> {\n    try {\n      // LinkedIn shows errors with specific classes\n      const errorSelectors = [\n        '.artdeco-inline-feedback--error',\n        '[data-test-form-element-error-message]',\n        '.fb-form-element__error-text',\n      ];\n\n      for (const selector of errorSelectors) {\n        const errors = await this.page.locator(selector).all();\n        for (const error of errors) {\n          if (await error.isVisible()) {\n            const text = await error.textContent();\n            if (text?.trim()) {\n              log.warn(`Validation error: \"${text}\"`);\n              return true;\n            }\n          }\n        }\n      }\n\n      return false;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Get all visible validation error messages\n   */\n  async getValidationErrors(): Promise<string[]> {\n    const errors: string[] = [];\n    \n    try {\n      const errorElements = await this.page.locator('.artdeco-inline-feedback--error').all();\n      \n      for (const element of errorElements) {\n        if (await element.isVisible()) {\n          const text = await element.textContent();\n          if (text?.trim()) {\n            errors.push(text.trim());\n          }\n        }\n      }\n    } catch {\n      // Ignore errors in error collection\n    }\n\n    return errors;\n  }\n\n  /**\n   * Wait for the modal to finish loading/transitioning\n   */\n  async waitForModalReady(): Promise<void> {\n    try {\n      // Wait for loading indicators to disappear\n      const loadingSpinner = this.page.locator('.artdeco-spinner');\n      await loadingSpinner.waitFor({ state: 'hidden', timeout: 5000 }).catch(() => {});\n      \n      // Small delay for any animations\n      await this.page.waitForTimeout(500);\n    } catch {\n      // Ignore timeout - modal might already be ready\n    }\n  }\n\n  /**\n   * Check if the modal is currently open\n   */\n  async isModalOpen(): Promise<boolean> {\n    try {\n      const modal = this.page.locator('[data-test-modal]').first();\n      return await modal.count() > 0 && await modal.isVisible();\n    } catch {\n      return false;\n    }\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
