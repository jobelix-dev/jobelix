{
  "version": 3,
  "sources": ["file-upload-handler.ts"],
  "sourcesContent": ["/**\n * File Upload Handler - Handles file upload fields (resume, cover letter, etc.)\n * \n * LinkedIn file uploads can include:\n * - Resume upload\n * - Cover letter upload\n * - Portfolio documents\n * - Previously uploaded file selection\n */\n\nimport type { Locator } from 'playwright';\nimport type { Page } from 'playwright';\nimport { BaseFieldHandler } from './base-handler';\nimport { createLogger } from '../../../utils/logger';\n\nconst log = createLogger('FileUploadHandler');\n\nexport class FileUploadHandler extends BaseFieldHandler {\n  private resumePath: string | null;\n  private coverLetterPath: string | null;\n\n  constructor(\n    page: Page,\n    gptAnswerer: any,\n    formUtils: any,\n    resumePath: string | null = null,\n    coverLetterPath: string | null = null\n  ) {\n    super(page, gptAnswerer, formUtils);\n    this.resumePath = resumePath;\n    this.coverLetterPath = coverLetterPath;\n  }\n\n  /**\n   * Check if this element is a file upload field\n   */\n  async canHandle(element: Locator): Promise<boolean> {\n    try {\n      // Check for file input\n      const fileInput = element.locator('input[type=\"file\"]');\n      if (await fileInput.count() > 0) return true;\n\n      // Check for upload button/label\n      const uploadLabel = element.locator('text=/upload|attach|document/i');\n      if (await uploadLabel.count() > 0) return true;\n\n      // Check for resume-specific attributes\n      const resumeSection = element.locator('[data-test-document-upload]');\n      if (await resumeSection.count() > 0) return true;\n\n      return false;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Handle a file upload field\n   */\n  async handle(element: Locator): Promise<boolean> {\n    try {\n      // Determine the type of document being requested\n      const questionText = await this.extractQuestionText(element);\n      const lowerQuestion = questionText.toLowerCase();\n\n      // Check if file is already uploaded (LinkedIn shows a green checkmark or filename)\n      const hasUploadedFile = await this.checkExistingUpload(element);\n      if (hasUploadedFile) {\n        log.debug('File already uploaded');\n        return true;\n      }\n\n      // Check for \"Use previous resume\" option first\n      const usedPrevious = await this.tryUsePreviousUpload(element);\n      if (usedPrevious) {\n        log.info('\u2705 Selected previously uploaded file');\n        return true;\n      }\n\n      // Determine which file to upload\n      let filePath: string | null = null;\n      \n      if (lowerQuestion.includes('resume') || lowerQuestion.includes('cv')) {\n        filePath = this.resumePath;\n        log.debug('Uploading resume');\n      } else if (lowerQuestion.includes('cover letter') || lowerQuestion.includes('coverletter')) {\n        filePath = this.coverLetterPath;\n        log.debug('Uploading cover letter');\n      } else {\n        // Default to resume for generic document requests\n        filePath = this.resumePath;\n        log.debug('Uploading resume (default)');\n      }\n\n      if (!filePath) {\n        log.warn(`No file available for upload: \"${questionText}\"`);\n        // Return true to not block the application - LinkedIn often allows skipping\n        return true;\n      }\n\n      // Upload the file\n      const success = await this.uploadFile(element, filePath);\n      \n      if (success) {\n        log.info(`\u2705 Uploaded file: ${filePath}`);\n      }\n\n      return success;\n\n    } catch (error) {\n      log.error(`Error handling file upload: ${error}`);\n      return false;\n    }\n  }\n\n  /**\n   * Check if a file is already uploaded\n   */\n  private async checkExistingUpload(element: Locator): Promise<boolean> {\n    try {\n      // LinkedIn shows uploaded files with specific classes\n      const uploadedFile = element.locator('.jobs-document-upload__filename');\n      if (await uploadedFile.count() > 0) {\n        return true;\n      }\n\n      // Check for success indicator\n      const successIndicator = element.locator('[data-test-document-upload-success]');\n      if (await successIndicator.count() > 0) {\n        return true;\n      }\n\n      // Check for file display container\n      const fileDisplay = element.locator('.jobs-document-upload-redesign-card__file-name');\n      if (await fileDisplay.count() > 0) {\n        const fileName = await fileDisplay.textContent();\n        if (fileName?.trim()) {\n          return true;\n        }\n      }\n\n      return false;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Try to use a previously uploaded file\n   */\n  private async tryUsePreviousUpload(element: Locator): Promise<boolean> {\n    try {\n      // Look for \"Be sure to include...\" option with existing files\n      const previousUploadOption = element.locator('[data-test-document-upload-file-card]').first();\n      \n      if (await previousUploadOption.count() > 0) {\n        await previousUploadOption.click();\n        await this.page.waitForTimeout(500);\n        return true;\n      }\n\n      // Alternative: Radio button to select existing file\n      const existingFileRadio = element.locator('input[type=\"radio\"][data-test-resume-radio]').first();\n      if (await existingFileRadio.count() > 0) {\n        await existingFileRadio.click();\n        await this.page.waitForTimeout(500);\n        return true;\n      }\n\n      return false;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Upload a file to the input\n   */\n  private async uploadFile(element: Locator, filePath: string): Promise<boolean> {\n    try {\n      // Find the file input\n      const fileInput = element.locator('input[type=\"file\"]').first();\n      \n      if (await fileInput.count() > 0) {\n        // Set file using Playwright's setInputFiles\n        await fileInput.setInputFiles(filePath);\n        \n        // Wait for upload to process\n        await this.page.waitForTimeout(2000);\n        \n        return true;\n      }\n\n      // If no file input, try clicking an upload button\n      const uploadButton = element.locator('button:has-text(\"Upload\"), label:has-text(\"Upload\")').first();\n      \n      if (await uploadButton.count() > 0) {\n        // This might open a file dialog - need to handle with fileChooser\n        const [fileChooser] = await Promise.all([\n          this.page.waitForEvent('filechooser', { timeout: 5000 }),\n          uploadButton.click()\n        ]);\n        \n        await fileChooser.setFiles(filePath);\n        await this.page.waitForTimeout(2000);\n        \n        return true;\n      }\n\n      log.warn('Could not find file input or upload button');\n      return false;\n\n    } catch (error) {\n      log.debug(`Upload error: ${error}`);\n      return false;\n    }\n  }\n\n  /**\n   * Set the resume path for uploads\n   */\n  setResumePath(path: string): void {\n    this.resumePath = path;\n  }\n\n  /**\n   * Set the cover letter path for uploads\n   */\n  setCoverLetterPath(path: string): void {\n    this.coverLetterPath = path;\n  }\n}\n"],
  "mappings": "AAYA,SAAS,wBAAwB;AACjC,SAAS,oBAAoB;AAE7B,MAAM,MAAM,aAAa,mBAAmB;AAErC,MAAM,0BAA0B,iBAAiB;AAAA,EAItD,YACE,MACA,aACA,WACA,aAA4B,MAC5B,kBAAiC,MACjC;AACA,UAAM,MAAM,aAAa,SAAS;AAClC,SAAK,aAAa;AAClB,SAAK,kBAAkB;AAAA,EACzB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,UAAU,SAAoC;AAClD,QAAI;AAEF,YAAM,YAAY,QAAQ,QAAQ,oBAAoB;AACtD,UAAI,MAAM,UAAU,MAAM,IAAI,EAAG,QAAO;AAGxC,YAAM,cAAc,QAAQ,QAAQ,gCAAgC;AACpE,UAAI,MAAM,YAAY,MAAM,IAAI,EAAG,QAAO;AAG1C,YAAM,gBAAgB,QAAQ,QAAQ,6BAA6B;AACnE,UAAI,MAAM,cAAc,MAAM,IAAI,EAAG,QAAO;AAE5C,aAAO;AAAA,IACT,QAAQ;AACN,aAAO;AAAA,IACT;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,OAAO,SAAoC;AAC/C,QAAI;AAEF,YAAM,eAAe,MAAM,KAAK,oBAAoB,OAAO;AAC3D,YAAM,gBAAgB,aAAa,YAAY;AAG/C,YAAM,kBAAkB,MAAM,KAAK,oBAAoB,OAAO;AAC9D,UAAI,iBAAiB;AACnB,YAAI,MAAM,uBAAuB;AACjC,eAAO;AAAA,MACT;AAGA,YAAM,eAAe,MAAM,KAAK,qBAAqB,OAAO;AAC5D,UAAI,cAAc;AAChB,YAAI,KAAK,0CAAqC;AAC9C,eAAO;AAAA,MACT;AAGA,UAAI,WAA0B;AAE9B,UAAI,cAAc,SAAS,QAAQ,KAAK,cAAc,SAAS,IAAI,GAAG;AACpE,mBAAW,KAAK;AAChB,YAAI,MAAM,kBAAkB;AAAA,MAC9B,WAAW,cAAc,SAAS,cAAc,KAAK,cAAc,SAAS,aAAa,GAAG;AAC1F,mBAAW,KAAK;AAChB,YAAI,MAAM,wBAAwB;AAAA,MACpC,OAAO;AAEL,mBAAW,KAAK;AAChB,YAAI,MAAM,4BAA4B;AAAA,MACxC;AAEA,UAAI,CAAC,UAAU;AACb,YAAI,KAAK,kCAAkC,YAAY,GAAG;AAE1D,eAAO;AAAA,MACT;AAGA,YAAM,UAAU,MAAM,KAAK,WAAW,SAAS,QAAQ;AAEvD,UAAI,SAAS;AACX,YAAI,KAAK,yBAAoB,QAAQ,EAAE;AAAA,MACzC;AAEA,aAAO;AAAA,IAET,SAAS,OAAO;AACd,UAAI,MAAM,+BAA+B,KAAK,EAAE;AAChD,aAAO;AAAA,IACT;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,oBAAoB,SAAoC;AACpE,QAAI;AAEF,YAAM,eAAe,QAAQ,QAAQ,iCAAiC;AACtE,UAAI,MAAM,aAAa,MAAM,IAAI,GAAG;AAClC,eAAO;AAAA,MACT;AAGA,YAAM,mBAAmB,QAAQ,QAAQ,qCAAqC;AAC9E,UAAI,MAAM,iBAAiB,MAAM,IAAI,GAAG;AACtC,eAAO;AAAA,MACT;AAGA,YAAM,cAAc,QAAQ,QAAQ,gDAAgD;AACpF,UAAI,MAAM,YAAY,MAAM,IAAI,GAAG;AACjC,cAAM,WAAW,MAAM,YAAY,YAAY;AAC/C,YAAI,UAAU,KAAK,GAAG;AACpB,iBAAO;AAAA,QACT;AAAA,MACF;AAEA,aAAO;AAAA,IACT,QAAQ;AACN,aAAO;AAAA,IACT;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,qBAAqB,SAAoC;AACrE,QAAI;AAEF,YAAM,uBAAuB,QAAQ,QAAQ,uCAAuC,EAAE,MAAM;AAE5F,UAAI,MAAM,qBAAqB,MAAM,IAAI,GAAG;AAC1C,cAAM,qBAAqB,MAAM;AACjC,cAAM,KAAK,KAAK,eAAe,GAAG;AAClC,eAAO;AAAA,MACT;AAGA,YAAM,oBAAoB,QAAQ,QAAQ,6CAA6C,EAAE,MAAM;AAC/F,UAAI,MAAM,kBAAkB,MAAM,IAAI,GAAG;AACvC,cAAM,kBAAkB,MAAM;AAC9B,cAAM,KAAK,KAAK,eAAe,GAAG;AAClC,eAAO;AAAA,MACT;AAEA,aAAO;AAAA,IACT,QAAQ;AACN,aAAO;AAAA,IACT;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,WAAW,SAAkB,UAAoC;AAC7E,QAAI;AAEF,YAAM,YAAY,QAAQ,QAAQ,oBAAoB,EAAE,MAAM;AAE9D,UAAI,MAAM,UAAU,MAAM,IAAI,GAAG;AAE/B,cAAM,UAAU,cAAc,QAAQ;AAGtC,cAAM,KAAK,KAAK,eAAe,GAAI;AAEnC,eAAO;AAAA,MACT;AAGA,YAAM,eAAe,QAAQ,QAAQ,qDAAqD,EAAE,MAAM;AAElG,UAAI,MAAM,aAAa,MAAM,IAAI,GAAG;AAElC,cAAM,CAAC,WAAW,IAAI,MAAM,QAAQ,IAAI;AAAA,UACtC,KAAK,KAAK,aAAa,eAAe,EAAE,SAAS,IAAK,CAAC;AAAA,UACvD,aAAa,MAAM;AAAA,QACrB,CAAC;AAED,cAAM,YAAY,SAAS,QAAQ;AACnC,cAAM,KAAK,KAAK,eAAe,GAAI;AAEnC,eAAO;AAAA,MACT;AAEA,UAAI,KAAK,4CAA4C;AACrD,aAAO;AAAA,IAET,SAAS,OAAO;AACd,UAAI,MAAM,iBAAiB,KAAK,EAAE;AAClC,aAAO;AAAA,IACT;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,MAAoB;AAChC,SAAK,aAAa;AAAA,EACpB;AAAA;AAAA;AAAA;AAAA,EAKA,mBAAmB,MAAoB;AACrC,SAAK,kBAAkB;AAAA,EACzB;AACF;",
  "names": []
}
