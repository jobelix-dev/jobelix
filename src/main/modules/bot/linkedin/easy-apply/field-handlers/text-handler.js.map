{
  "version": 3,
  "sources": ["text-handler.ts"],
  "sourcesContent": ["/**\n * Text Input Handler - Handles single-line text inputs\n * \n * Used for fields like:\n * - Name, email, phone number\n * - Years of experience (numeric)\n * - City, company name, URLs\n */\n\nimport type { Locator } from 'playwright-core';\nimport { BaseFieldHandler } from './base-handler';\nimport { createLogger } from '../../../utils/logger';\nimport { TIMEOUTS } from '../selectors';\n\nconst log = createLogger('TextHandler');\n\n/** Input types to exclude */\nconst EXCLUDED_INPUT_TYPES = ['button', 'submit', 'checkbox', 'radio', 'file', 'hidden'];\n\nexport class TextInputHandler extends BaseFieldHandler {\n  /**\n   * Check if this element contains a text input\n   */\n  async canHandle(element: Locator): Promise<boolean> {\n    try {\n      const inputs = await element.locator('input').all();\n      for (const input of inputs) {\n        const type = await input.getAttribute('type') || 'text';\n        if (!EXCLUDED_INPUT_TYPES.includes(type)) return true;\n      }\n      return false;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Handle a text input field\n   */\n  async handle(element: Locator): Promise<boolean> {\n    try {\n      const input = element.locator('input').first();\n      if (await input.count() === 0) return false;\n\n      const inputType = await input.getAttribute('type') || 'text';\n      if (EXCLUDED_INPUT_TYPES.includes(inputType)) return false;\n\n      const questionText = await this.extractQuestionText(element);\n      log.debug(`Question: \"${questionText}\"`);\n\n      // Always clear and get fresh answer from GPT (don't trust LinkedIn prefill)\n      const existingValue = await input.inputValue();\n      if (existingValue?.trim()) {\n        log.debug(`Clearing LinkedIn prefill: \"${existingValue}\"`);\n      }\n\n      // Get answer from GPT\n      const answer = await this.askGpt(input, questionText);\n      if (!answer?.trim()) {\n        log.warn('No answer available for text input');\n        return false;\n      }\n\n      log.info(`\u2705 Q: \"${questionText}\" \u2192 \"${this.truncate(answer)}\"`);\n\n      // Fill the input\n      await this.fillInput(input, answer);\n      this.formUtils.rememberAnswer('text', questionText, answer);\n\n      // Handle validation errors with retry\n      await this.handleValidationError(\n        element, 'text', questionText, answer,\n        (q, a, e) => this.gptAnswerer.answerTextualWithRetry(q, a, e),\n        async (retryAnswer) => this.fillInput(input, retryAnswer)\n      );\n\n      return true;\n    } catch (error) {\n      log.error(`Error handling text input: ${error}`);\n      return false;\n    }\n  }\n\n  /**\n   * Ask GPT for an answer (numeric or textual)\n   */\n  private async askGpt(input: Locator, questionText: string): Promise<string | undefined> {\n    const isNumeric = await this.isNumericField(input);\n    \n    if (isNumeric) {\n      log.debug(`Asking GPT (numeric): \"${questionText}\"`);\n      const numAnswer = await this.gptAnswerer.answerNumeric(questionText);\n      return String(numAnswer);\n    } else {\n      log.debug(`Asking GPT (textual): \"${questionText}\"`);\n      return this.gptAnswerer.answerTextual(questionText);\n    }\n  }\n\n  /**\n   * Fill an input field\n   */\n  private async fillInput(input: Locator, value: string): Promise<void> {\n    await input.click();\n    await input.fill('');\n    await input.fill(value);\n    await this.page.waitForTimeout(TIMEOUTS.short);\n  }\n\n  /**\n   * Truncate text for logging\n   */\n  private truncate(text: string, maxLen = 50): string {\n    return text.length > maxLen ? `${text.substring(0, maxLen)}...` : text;\n  }\n\n  /**\n   * Check if this is a numeric field\n   */\n  private async isNumericField(input: Locator): Promise<boolean> {\n    try {\n      const type = await input.getAttribute('type');\n      if (type === 'number') return true;\n\n      const inputmode = await input.getAttribute('inputmode');\n      if (inputmode && ['numeric', 'decimal'].includes(inputmode)) return true;\n\n      const id = await input.getAttribute('id') || '';\n      const name = await input.getAttribute('name') || '';\n\n      return (\n        id.includes('numeric') ||\n        id.includes('number') ||\n        name.includes('numeric') ||\n        name.includes('number')\n      );\n    } catch {\n      return false;\n    }\n  }\n}\n"],
  "mappings": "AAUA,SAAS,wBAAwB;AACjC,SAAS,oBAAoB;AAC7B,SAAS,gBAAgB;AAEzB,MAAM,MAAM,aAAa,aAAa;AAGtC,MAAM,uBAAuB,CAAC,UAAU,UAAU,YAAY,SAAS,QAAQ,QAAQ;AAEhF,MAAM,yBAAyB,iBAAiB;AAAA;AAAA;AAAA;AAAA,EAIrD,MAAM,UAAU,SAAoC;AAClD,QAAI;AACF,YAAM,SAAS,MAAM,QAAQ,QAAQ,OAAO,EAAE,IAAI;AAClD,iBAAW,SAAS,QAAQ;AAC1B,cAAM,OAAO,MAAM,MAAM,aAAa,MAAM,KAAK;AACjD,YAAI,CAAC,qBAAqB,SAAS,IAAI,EAAG,QAAO;AAAA,MACnD;AACA,aAAO;AAAA,IACT,QAAQ;AACN,aAAO;AAAA,IACT;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,OAAO,SAAoC;AAC/C,QAAI;AACF,YAAM,QAAQ,QAAQ,QAAQ,OAAO,EAAE,MAAM;AAC7C,UAAI,MAAM,MAAM,MAAM,MAAM,EAAG,QAAO;AAEtC,YAAM,YAAY,MAAM,MAAM,aAAa,MAAM,KAAK;AACtD,UAAI,qBAAqB,SAAS,SAAS,EAAG,QAAO;AAErD,YAAM,eAAe,MAAM,KAAK,oBAAoB,OAAO;AAC3D,UAAI,MAAM,cAAc,YAAY,GAAG;AAGvC,YAAM,gBAAgB,MAAM,MAAM,WAAW;AAC7C,UAAI,eAAe,KAAK,GAAG;AACzB,YAAI,MAAM,+BAA+B,aAAa,GAAG;AAAA,MAC3D;AAGA,YAAM,SAAS,MAAM,KAAK,OAAO,OAAO,YAAY;AACpD,UAAI,CAAC,QAAQ,KAAK,GAAG;AACnB,YAAI,KAAK,oCAAoC;AAC7C,eAAO;AAAA,MACT;AAEA,UAAI,KAAK,cAAS,YAAY,aAAQ,KAAK,SAAS,MAAM,CAAC,GAAG;AAG9D,YAAM,KAAK,UAAU,OAAO,MAAM;AAClC,WAAK,UAAU,eAAe,QAAQ,cAAc,MAAM;AAG1D,YAAM,KAAK;AAAA,QACT;AAAA,QAAS;AAAA,QAAQ;AAAA,QAAc;AAAA,QAC/B,CAAC,GAAG,GAAG,MAAM,KAAK,YAAY,uBAAuB,GAAG,GAAG,CAAC;AAAA,QAC5D,OAAO,gBAAgB,KAAK,UAAU,OAAO,WAAW;AAAA,MAC1D;AAEA,aAAO;AAAA,IACT,SAAS,OAAO;AACd,UAAI,MAAM,8BAA8B,KAAK,EAAE;AAC/C,aAAO;AAAA,IACT;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,OAAO,OAAgB,cAAmD;AACtF,UAAM,YAAY,MAAM,KAAK,eAAe,KAAK;AAEjD,QAAI,WAAW;AACb,UAAI,MAAM,0BAA0B,YAAY,GAAG;AACnD,YAAM,YAAY,MAAM,KAAK,YAAY,cAAc,YAAY;AACnE,aAAO,OAAO,SAAS;AAAA,IACzB,OAAO;AACL,UAAI,MAAM,0BAA0B,YAAY,GAAG;AACnD,aAAO,KAAK,YAAY,cAAc,YAAY;AAAA,IACpD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,UAAU,OAAgB,OAA8B;AACpE,UAAM,MAAM,MAAM;AAClB,UAAM,MAAM,KAAK,EAAE;AACnB,UAAM,MAAM,KAAK,KAAK;AACtB,UAAM,KAAK,KAAK,eAAe,SAAS,KAAK;AAAA,EAC/C;AAAA;AAAA;AAAA;AAAA,EAKQ,SAAS,MAAc,SAAS,IAAY;AAClD,WAAO,KAAK,SAAS,SAAS,GAAG,KAAK,UAAU,GAAG,MAAM,CAAC,QAAQ;AAAA,EACpE;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,eAAe,OAAkC;AAC7D,QAAI;AACF,YAAM,OAAO,MAAM,MAAM,aAAa,MAAM;AAC5C,UAAI,SAAS,SAAU,QAAO;AAE9B,YAAM,YAAY,MAAM,MAAM,aAAa,WAAW;AACtD,UAAI,aAAa,CAAC,WAAW,SAAS,EAAE,SAAS,SAAS,EAAG,QAAO;AAEpE,YAAM,KAAK,MAAM,MAAM,aAAa,IAAI,KAAK;AAC7C,YAAM,OAAO,MAAM,MAAM,aAAa,MAAM,KAAK;AAEjD,aACE,GAAG,SAAS,SAAS,KACrB,GAAG,SAAS,QAAQ,KACpB,KAAK,SAAS,SAAS,KACvB,KAAK,SAAS,QAAQ;AAAA,IAE1B,QAAQ;AACN,aAAO;AAAA,IACT;AAAA,EACF;AACF;",
  "names": []
}
