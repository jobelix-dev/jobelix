{
  "version": 3,
  "sources": ["document-type-detector.ts"],
  "sourcesContent": ["/**\n * Document Type Detector - Detects whether a file upload field is for resume or cover letter\n * \n * Uses HTML attributes and URN patterns for reliable detection, with keyword fallback.\n */\n\nimport type { Locator } from 'playwright-core';\nimport { createLogger } from '../../../utils/logger';\n\nconst log = createLogger('DocumentTypeDetector');\n\n/** Document type detection result */\nexport interface DocumentTypeResult {\n  isResumeUpload: boolean;\n  isCoverLetterUpload: boolean;\n  detectedBy: 'urn-pattern' | 'attribute' | 'question-text' | 'default';\n}\n\n/** Cover letter keywords (multi-language) for HTML attribute detection */\nconst COVER_LETTER_ID_KEYWORDS = [\n  'cover', 'coverletter', 'cover-letter',  // English\n  'lettre', 'motivation',                  // French (lettre de motivation)\n  'anschreiben', 'bewerbung',              // German\n  'carta', 'presentacion',                 // Spanish (carta de presentaci\u00F3n)\n  'lettera', 'presentazione',              // Italian (lettera di presentazione)\n  'carta-apresentacao'                     // Portuguese\n];\n\n/** Cover letter keywords for question text detection */\nconst COVER_LETTER_TEXT_KEYWORDS = [\n  'cover letter', 'coverletter',                   // English\n  'lettre de motivation', 'lettre motivation',     // French\n  'anschreiben', 'motivationsschreiben',           // German\n  'carta de presentaci\u00F3n', 'carta presentaci\u00F3n',   // Spanish\n  'lettera di presentazione',                      // Italian\n  'carta de apresenta\u00E7\u00E3o'                          // Portuguese\n];\n\n/** Resume keywords for question text detection */\nconst RESUME_TEXT_KEYWORDS = [\n  'resume', 'cv', 'lebenslauf', 'curriculum'\n];\n\n/**\n * Detect document type from file input element\n */\nexport async function detectDocumentType(\n  fileInput: Locator,\n  questionText: string\n): Promise<DocumentTypeResult> {\n  let result: DocumentTypeResult = {\n    isResumeUpload: true,\n    isCoverLetterUpload: false,\n    detectedBy: 'default'\n  };\n\n  try {\n    if (await fileInput.count() > 0) {\n      // Try URN pattern first (most reliable)\n      const urnResult = await detectByUrnPattern(fileInput);\n      if (urnResult) return urnResult;\n\n      // Try HTML attribute keywords\n      const attrResult = await detectByAttributes(fileInput);\n      if (attrResult) return attrResult;\n    }\n  } catch {\n    // Fall through to question text detection\n  }\n\n  // Try question text as secondary signal\n  const textResult = detectByQuestionText(questionText);\n  if (textResult) return textResult;\n\n  return result;\n}\n\n/**\n * Detect document type from URN pattern in input ID\n * \n * LinkedIn IDs follow: jobs-document-upload-file-input-upload-{type}-urn:li:...\n * Example: upload-resume-urn:li:... \u2192 RESUME\n * Example: upload-cover-letter-urn:li:... \u2192 COVER LETTER\n * \n * IMPORTANT: When there's NO \"upload-{type}\" pattern, it's typically an\n * additional/optional document field (cover letter, portfolio, etc.)\n * Example: jobs-document-upload-file-input-urn:li:... \u2192 NOT resume (no upload-resume)\n */\nasync function detectByUrnPattern(fileInput: Locator): Promise<DocumentTypeResult | null> {\n  try {\n    const inputId = ((await fileInput.getAttribute('id')) || '').toLowerCase();\n    log.debug(`File input id: \"${inputId}\"`);\n    \n    // Check for explicit upload-{type}-urn pattern\n    const idMatch = inputId.match(/upload-([a-z-]+)-urn/);\n    \n    if (idMatch) {\n      const docType = idMatch[1];\n      log.debug(`Detected document type from URN: \"${docType}\"`);\n\n      if (docType.includes('cover') || docType.includes('letter')) {\n        return { isResumeUpload: false, isCoverLetterUpload: true, detectedBy: 'urn-pattern' };\n      }\n      \n      if (docType.includes('resume') || docType.includes('cv')) {\n        return { isResumeUpload: true, isCoverLetterUpload: false, detectedBy: 'urn-pattern' };\n      }\n    }\n    \n    // CRITICAL: If the ID contains \"jobs-document-upload-file-input-urn\" but NOT \"upload-resume\",\n    // this is likely a secondary document field (cover letter, portfolio, etc.)\n    // Resume fields ALWAYS have \"upload-resume\" in the ID!\n    if (inputId.includes('jobs-document-upload-file-input-urn') && !inputId.includes('upload-resume')) {\n      log.debug('No \"upload-resume\" in ID - treating as cover letter/additional document');\n      return { isResumeUpload: false, isCoverLetterUpload: true, detectedBy: 'urn-pattern' };\n    }\n  } catch {\n    // Ignore errors\n  }\n  return null;\n}\n\n/**\n * Detect document type from HTML attributes (id, name, aria-label)\n */\nasync function detectByAttributes(fileInput: Locator): Promise<DocumentTypeResult | null> {\n  try {\n    const inputId = ((await fileInput.getAttribute('id')) || '').toLowerCase();\n    const inputName = ((await fileInput.getAttribute('name')) || '').toLowerCase();\n    const ariaLabel = ((await fileInput.getAttribute('aria-label')) || '').toLowerCase();\n\n    log.debug(`File input - id: \"${inputId}\", name: \"${inputName}\", aria-label: \"${ariaLabel}\"`);\n\n    const combined = `${inputId} ${inputName} ${ariaLabel}`;\n    \n    if (COVER_LETTER_ID_KEYWORDS.some(k => combined.includes(k))) {\n      return { isResumeUpload: false, isCoverLetterUpload: true, detectedBy: 'attribute' };\n    }\n  } catch {\n    // Ignore errors\n  }\n  return null;\n}\n\n/**\n * Detect document type from question text\n */\nfunction detectByQuestionText(questionText: string): DocumentTypeResult | null {\n  const lowerQuestion = questionText.toLowerCase();\n\n  if (COVER_LETTER_TEXT_KEYWORDS.some(k => lowerQuestion.includes(k))) {\n    return { isResumeUpload: false, isCoverLetterUpload: true, detectedBy: 'question-text' };\n  }\n\n  if (RESUME_TEXT_KEYWORDS.some(k => lowerQuestion.includes(k))) {\n    return { isResumeUpload: true, isCoverLetterUpload: false, detectedBy: 'question-text' };\n  }\n\n  return null;\n}\n"],
  "mappings": "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",
  "names": []
}
