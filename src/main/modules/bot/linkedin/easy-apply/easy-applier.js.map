{
  "version": 3,
  "sources": ["easy-applier.ts"],
  "sourcesContent": ["/**\n * Easy Applier - LinkedIn Easy Apply automation\n * \n * Flow: Click Easy Apply \u2192 Fill forms \u2192 Navigate pages \u2192 Submit\n */\n\nimport type { Page } from 'playwright';\nimport type { SavedAnswer, Job } from '../../types';\nimport type { StatusReporter } from '../../utils/status-reporter';\nimport { createLogger } from '../../utils/logger';\nimport { saveDebugHtml } from '../../utils/debug-html';\nimport { FormHandler, AnswerRecordCallback } from './form-handler';\nimport { NavigationHandler } from './navigation';\nimport { \n  EASY_APPLY_BUTTON_SELECTORS, \n  ALREADY_APPLIED_SELECTORS, \n  JOB_DESCRIPTION_SELECTORS,\n  MODAL \n} from './selectors';\nimport { getResumePath, getTailoredResumesPath } from '../../utils/paths';\nimport { generateTailoredResume } from '../../models/resume-generator';\nimport * as fs from 'fs';\n\nconst log = createLogger('EasyApplier');\n\n/** Result of an Easy Apply attempt */\nexport interface EasyApplyResult {\n  success: boolean;\n  jobTitle: string;\n  company: string;\n  error?: string;\n  alreadyApplied?: boolean;\n  pagesCompleted: number;\n  totalFields: number;\n  failedFields: number;\n}\n\n/** Configuration for Easy Applier */\nexport interface EasyApplierConfig {\n  maxPages: number;\n  maxRetries: number;\n  resumePath?: string;\n  coverLetterPath?: string;\n  skipOnError: boolean;\n  dryRun: boolean;\n  /** If true, use the same resume for all applications (skip tailoring) */\n  useConstantResume?: boolean;\n}\n\nconst DEFAULT_CONFIG: EasyApplierConfig = {\n  maxPages: 15,\n  maxRetries: 3,\n  skipOnError: true,\n  dryRun: false,\n};\n\nexport class EasyApplier {\n  private page: Page;\n  private gptAnswerer: any;\n  private formHandler: FormHandler;\n  private navHandler: NavigationHandler;\n  private config: EasyApplierConfig;\n  private savedAnswers: SavedAnswer[];\n  private recordCallback?: AnswerRecordCallback;\n  private reporter?: StatusReporter;\n\n  /**\n   * Create a new Easy Applier instance \n   * @param page - Playwright page with job posting open\n   * @param gptAnswerer - GPT answerer for generating form responses\n   * @param savedAnswers - Previously saved Q&A pairs\n   * @param resumePath - Path to resume PDF file\n   * @param recordCallback - Callback to persist new answers\n   * @param reporter - Status reporter for UI updates\n   */\n  constructor(\n    page: Page,\n    gptAnswerer: any,\n    savedAnswers: SavedAnswer[] = [],\n    resumePath?: string,\n    recordCallback?: AnswerRecordCallback,\n    reporter?: StatusReporter\n  ) {\n    this.page = page;\n    this.gptAnswerer = gptAnswerer;\n    this.savedAnswers = savedAnswers;\n    this.recordCallback = recordCallback;\n    this.reporter = reporter;\n    this.config = { \n      ...DEFAULT_CONFIG, \n      resumePath \n    };\n    \n    // Initialize handlers\n    this.formHandler = new FormHandler(\n      page,\n      gptAnswerer,\n      savedAnswers,\n      recordCallback,\n      this.config.resumePath,\n      this.config.coverLetterPath\n    );\n    \n    this.navHandler = new NavigationHandler(page);\n  }\n\n  /**\n   * Save debug HTML snapshot - delegates to shared utility\n   */\n  private async saveHtml(context: string, jobTitle: string = ''): Promise<string | null> {\n    return saveDebugHtml(this.page, context, jobTitle);\n  }\n\n  /**\n   * Apply to a job using Easy Apply\n   * \n   * This is the main entry point. It:\n   * 1. Opens the Easy Apply modal\n   * 2. Loops through all form pages\n   * 3. Submits the application\n   * \n   * @param job - Job to apply to\n   * @returns Result of the application attempt\n   */\n  async apply(job: Job): Promise<EasyApplyResult> {\n    const result: EasyApplyResult = {\n      success: false,\n      jobTitle: job.title,\n      company: job.company,\n      pagesCompleted: 0,\n      totalFields: 0,\n      failedFields: 0,\n    };\n\n    log.info(`\uD83C\uDFAF Starting Easy Apply: \"${job.title}\" at ${job.company}`);\n\n    try {\n      // Step 0: Navigate to the job page (CRITICAL - matches Python bot)\n      log.debug(`Navigating to job page: ${job.link}`);\n      await this.page.goto(job.link, { \n        waitUntil: 'domcontentloaded', \n        timeout: 60000 \n      });\n      \n      // Wait for page to be interactive\n      await this.page.waitForLoadState('domcontentloaded');\n      await this.page.waitForTimeout(1000 + Math.random() * 500);\n      \n      log.debug('Job page loaded');\n      \n      // Save debug HTML after loading job page\n      await this.saveHtml('job_page_loaded', job.title);\n\n      // Step 0.5: Extract job description (needed for resume tailoring and GPT context)\n      const jobDescription = await this.getJobDescription();\n      if (jobDescription) {\n        job.description = jobDescription;\n        log.debug(`Job description extracted: ${jobDescription.length} chars`);\n      }\n\n      // Step 0.6: Resume tailoring (MATCHES PYTHON BOT - this is the critical step!)\n      if (this.config.useConstantResume) {\n        log.info(`\uD83D\uDCC4 Using constant resume (tailoring disabled)`);\n      } else if (jobDescription && this.gptAnswerer) {\n        try {\n          const tailoredResumePath = await this.generateTailoredResume(job, jobDescription);\n          if (tailoredResumePath) {\n            // Update the form handler with the tailored resume path (critical!)\n            this.formHandler.setResumePath(tailoredResumePath);\n            log.info(`\uD83C\uDFAF Using tailored resume: ${tailoredResumePath}`);\n          }\n        } catch (error) {\n          log.warn(`Failed to tailor resume, using original: ${error}`);\n        }\n      }\n\n      // Step 1: Open the Easy Apply modal\n      const modalResult = await this.openEasyApplyModal();\n      \n      if (modalResult === 'already_applied') {\n        result.error = 'Already applied to this job';\n        result.alreadyApplied = true;\n        log.info('\u23ED\uFE0F Skipping - already applied to this job');\n        return result;\n      }\n      \n      if (modalResult === 'failed') {\n        result.error = 'Could not open Easy Apply modal';\n        log.error(result.error);\n        await this.cleanupFailure();  // Clean up any open modals or dialogs\n        return result;\n      }\n\n      // Step 2: Set the job context for GPT (helps with relevant answers)\n      await this.setJobContext(job);\n\n      // Step 3: Process all pages until submission (includes form filling + navigation + submit)\n      const processResult = await this.processAllPages(result);\n      \n      if (!processResult.success) {\n        result.error = processResult.error;\n        await this.cleanupFailure();\n        return result;\n      }\n\n      // processAllPages handles everything including submission\n      // Set success based on process result\n      if (!this.config.dryRun) {\n        result.success = processResult.success;\n      } else {\n        log.info('\uD83E\uDDEA Dry run mode - application was not actually submitted');\n        result.success = true;\n        await this.navHandler.closeModal();\n      }\n\n      if (result.success) {\n        log.info(`\u2705 Successfully applied to \"${job.title}\" at ${job.company}`);\n      }\n\n    } catch (error) {\n      result.error = String(error);\n      log.error(`Error during Easy Apply: ${error}`);\n      await this.saveHtml('apply_error', result.jobTitle);\n      await this.cleanupFailure();\n    }\n\n    return result;\n  }\n\n  /** Check if job was already applied to */\n  private async isAlreadyApplied(): Promise<boolean> {\n    try {\n      for (const selector of ALREADY_APPLIED_SELECTORS) {\n        try {\n          const indicator = this.page.locator(selector).first();\n          if (await indicator.count() > 0 && await indicator.isVisible()) {\n            log.info(`Job already applied (found indicator)`);\n            return true;\n          }\n        } catch { /* continue */ }\n      }\n      return false;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Open the Easy Apply modal on the current job page\n   * \n  /** Open the Easy Apply modal */\n  private async openEasyApplyModal(): Promise<'opened' | 'already_applied' | 'failed'> {\n    try {\n      if (await this.isAlreadyApplied()) {\n        log.warn('Job already applied - skipping');\n        return 'already_applied';\n      }\n\n      await this.saveHtml('before_find_button');\n\n      // Find Easy Apply button using international selectors\n      let easyApplyButton;\n      let buttonLabel = '';\n\n      for (const selector of EASY_APPLY_BUTTON_SELECTORS) {\n        try {\n          const buttons = this.page.locator(selector);\n          await buttons.first().waitFor({ state: 'attached', timeout: 3000 }).catch(() => {});\n          \n          for (const button of await buttons.all()) {\n            try {\n              if (await button.isVisible() && await button.isEnabled()) {\n                easyApplyButton = button;\n                buttonLabel = (await button.textContent())?.trim() || \n                             await button.getAttribute('aria-label') || '';\n                log.info(`\u2713 Found Easy Apply button: ${selector}`);\n                break;\n              }\n            } catch { continue; }\n          }\n          if (easyApplyButton) break;\n        } catch { continue; }\n      }\n\n      if (!easyApplyButton) {\n        log.warn('Easy Apply button not found');\n        await this.saveHtml('button_not_found');\n        return 'failed';\n      }\n\n      // Click button or navigate to href\n      const href = await easyApplyButton.getAttribute('href');\n      if (href) {\n        log.info(`Navigating to apply URL`);\n        await this.page.goto(href, { waitUntil: 'domcontentloaded', timeout: 60000 });\n      } else {\n        log.info('Clicking Easy Apply button');\n        await easyApplyButton.click();\n      }\n\n      // Wait for modal with retry loop (matches Python)\n      log.info('Waiting for Easy Apply modal...');\n      const maxAttempts = 3;\n      let modalFound = false;\n      \n      for (let attempt = 1; attempt <= maxAttempts; attempt++) {\n        const modalElements = await this.page.locator(MODAL.container).all();\n        \n        if (modalElements.length > 0) {\n          try {\n            await this.page.waitForSelector(MODAL.container, { timeout: 10000, state: 'visible' });\n            modalFound = true;\n            log.info('\u2705 Easy Apply modal visible');\n            break;\n          } catch {\n            if (attempt < maxAttempts) await this.page.waitForTimeout(2000);\n          }\n        } else {\n          if (attempt < maxAttempts) await this.page.waitForTimeout(3000);\n        }\n      }\n\n      if (!modalFound) {\n        log.error('Easy Apply modal did not appear');\n        await this.saveHtml('modal_not_opened');\n        return 'failed';\n      }\n\n      await this.navHandler.waitForModalReady();\n      await this.saveHtml('modal_opened');\n      return 'opened';\n\n    } catch (error) {\n      log.error(`Failed to open Easy Apply modal: ${error}`);\n      await this.saveHtml('modal_open_error');\n      return 'failed';\n    }\n  }\n\n  /**\n   * Set job context for GPT to provide better answers\n   */\n  private async setJobContext(job: Job): Promise<void> {\n    try {\n      const context = `\nJob Title: ${job.title}\nCompany: ${job.company}\nLocation: ${job.location}\nDescription: ${job.description?.substring(0, 500) || 'N/A'}\n      `.trim();\n\n      await this.gptAnswerer.setJobContext(context);\n      log.debug('Job context set for GPT');\n    } catch {\n      // Ignore - GPT answerer might not support this\n    }\n  }\n\n  /**\n   * Process all pages of the Easy Apply form\n   * \n   * MATCHES PYTHON BOT FLOW:\n   * 1. Wait for modal to be ready\n   * 2. Fill ALL form fields on current page\n   * 3. Click the primary button (Next/Review/Submit)\n   * 4. Check if modal is still open - if not, application is complete\n   * 5. Repeat until done\n   */\n  private async processAllPages(result: EasyApplyResult): Promise<{ success: boolean; error?: string }> {\n    let retries = 0;\n    let step = 0;\n    \n    while (step < this.config.maxPages) {\n      step++;\n      log.info(`========== EASY-APPLY Step ${step} ==========`);\n      \n      // Save debug HTML at start of each step\n      await this.saveHtml(`step_${step}_start`);\n      \n      // Check if modal is still open before processing\n      const isModalOpen = await this.navHandler.isModalOpen();\n      if (!isModalOpen) {\n        log.info('Modal closed - application complete');\n        return { success: true };\n      }\n      \n      // STEP 1: Fill ALL form fields on this page (MATCHES PYTHON _answer_visible_form)\n      log.debug(`Step ${step}.1: Filling form fields`);\n      const pageResult = await this.formHandler.fillCurrentPage();\n      result.totalFields += pageResult.fieldsProcessed;\n      result.failedFields += pageResult.fieldsFailed;\n      \n      log.info(`Form page complete: ${pageResult.fieldsProcessed - pageResult.fieldsFailed}/${pageResult.fieldsProcessed} fields filled`);\n      \n      // Save debug HTML after filling form\n      await this.saveHtml(`step_${step}_after_fill`);\n      \n      // STEP 2: Click the primary action button (Next/Review/Submit)\n      log.debug(`Step ${step}.2: Clicking primary action button`);\n      const navResult = await this.navHandler.clickPrimaryButton();\n      \n      if (!navResult.success) {\n        // Save debug HTML on error\n        await this.saveHtml(`step_${step}_nav_error`);\n        \n        // Navigation failed - might have validation errors\n        if (await this.navHandler.hasValidationErrors()) {\n          retries++;\n          if (retries > this.config.maxRetries) {\n            const errors = await this.navHandler.getValidationErrors();\n            await this.saveHtml(`step_${step}_validation_failed`);\n            return { \n              success: false, \n              error: `Validation errors: ${errors.join(', ')}` \n            };\n          }\n          log.warn(`Validation errors on step ${step}, retry ${retries}/${this.config.maxRetries}`);\n          continue;  // Retry filling and clicking\n        }\n        \n        return { success: false, error: navResult.error || 'Navigation failed' };\n      }\n      \n      // Check if this was the final submission\n      if (navResult.submitted) {\n        log.info('Application submitted successfully \u2714');\n        await this.saveHtml('submitted_success');\n        result.pagesCompleted = step;\n        \n        // Post-submit handling (MATCHES PYTHON _handle_post_submit_modal)\n        await this.handlePostSubmit();\n        \n        return { success: true };\n      }\n      \n      // STEP 3: Check if modal is still open (MATCHES PYTHON modal check)\n      // Give page time to transition\n      await this.page.waitForTimeout(1000);\n      \n      const stillOpen = await this.navHandler.isModalOpen();\n      if (!stillOpen) {\n        log.info('Modal closed after navigation - application complete');\n        result.pagesCompleted = step;\n        return { success: true };\n      }\n      \n      // Successfully completed this step, more to come\n      result.pagesCompleted = step;\n      retries = 0;\n      \n      // Wait for next page to stabilize\n      await this.navHandler.waitForModalReady();\n    }\n\n    return { success: false, error: `Exceeded maximum pages (${this.config.maxPages})` };\n  }\n\n  /**\n   * Handle the final submission step\n   * \n   * Note: With the new flow, clickPrimaryButton() handles submission directly.\n   * This method is now only called as a fallback.\n   */\n  private async handleSubmission(): Promise<{ success: boolean; error?: string }> {\n    // Use the new clickPrimaryButton which handles Submit\n    const result = await this.navHandler.clickPrimaryButton();\n    \n    if (result.success && result.submitted) {\n      await this.handlePostSubmit();\n      return { success: true };\n    }\n\n    return { success: result.success, error: result.error };\n  }\n\n  /**\n   * Handle post-submission modal/page stabilization\n   * \n   * MATCHES PYTHON _handle_post_submit_modal:\n   * - As of Nov 2025, LinkedIn no longer shows post-submission modals\n   * - After submission, it directly shows related jobs\n   * - This method waits for page to stabilize\n   */\n  private async handlePostSubmit(): Promise<void> {\n    try {\n      log.info('Application submitted - waiting for page to stabilize...');\n      \n      // Brief wait for any animations/redirects (matches Python's time.sleep(2))\n      await this.page.waitForTimeout(2000);\n      \n      // Check if we're still on the job page by looking for job content\n      try {\n        await this.page.waitForSelector(\"span[data-testid='expandable-text-box']\", { timeout: 3000 });\n        log.info('\u2713 Application completed successfully');\n      } catch {\n        log.debug('Job description not found after submission - might have navigated away');\n      }\n      \n    } catch (error) {\n      log.warn(`Post-submission check encountered issue: ${error}`);\n      // Not critical - application was already submitted\n      log.info('Proceeding despite post-submission check failure');\n    }\n  }\n\n  /**\n   * Clean up after a failed application\n   */\n  private async cleanupFailure(): Promise<void> {\n    try {\n      if (await this.navHandler.isModalOpen()) {\n        await this.navHandler.closeModal();\n      }\n    } catch { /* ignore */ }\n  }\n\n  /** Extract job description using multiple selectors */\n  private async getJobDescription(): Promise<string> {\n    try {\n      // Try to expand \"show more\" button first\n      try {\n        const moreBtn = this.page.locator(\n          'button.inline-show-more-text__button, button.jobs-description__footer-button'\n        ).first();\n        if (await moreBtn.isVisible()) {\n          await moreBtn.click();\n          await this.page.waitForTimeout(350);\n        }\n      } catch { /* not found */ }\n\n      // Try each selector in priority order\n      for (const selector of JOB_DESCRIPTION_SELECTORS) {\n        try {\n          const element = this.page.locator(selector).first();\n          await element.waitFor({ state: 'attached', timeout: 5000 });\n          const text = await element.textContent();\n          if (text?.trim()) {\n            log.debug(`Found description (${text.length} chars)`);\n            return text.trim();\n          }\n        } catch { continue; }\n      }\n\n      log.warn('Could not find job description');\n      return '';\n    } catch (error) {\n      log.error(`Error extracting job description: ${error}`);\n      return '';\n    }\n  }\n\n  /**\n   * Generate a tailored resume for the specific job application (MATCHES PYTHON)\n   * \n   * Uses GPT to customize the resume YAML for this specific job,\n   * then generates a PDF from the tailored config.\n   * \n   * @param job - Job object containing job details\n   * @param jobDescription - Full job description text\n   * @returns Path to the generated tailored resume PDF, or null if generation fails\n   */\n  private async generateTailoredResume(job: Job, jobDescription: string): Promise<string | null> {\n    try {\n      // Get base resume config path\n      const baseResumePath = getResumePath();\n      if (!fs.existsSync(baseResumePath)) {\n        log.error(`Resume config not found: ${baseResumePath}`);\n        log.error('Cannot tailor resume without base resume.yaml file');\n        return null;\n      }\n\n      log.info(`\uD83C\uDFAF Tailoring resume for ${job.company} - ${job.title}`);\n      log.debug(`Using base resume config: ${baseResumePath}`);\n\n      // Read the base resume YAML\n      const baseResumeYaml = fs.readFileSync(baseResumePath, 'utf-8');\n\n      // Use GPT to tailor the resume configuration (4-stage pipeline)\n      const tailoredConfigYaml = await this.gptAnswerer.tailorResumeToJob(\n        jobDescription,\n        baseResumeYaml\n      );\n\n      if (!tailoredConfigYaml || tailoredConfigYaml.length < 100) {\n        log.error('Invalid tailored config received from API');\n        return null;\n      }\n\n      // Generate the tailored PDF\n      const result = await generateTailoredResume({\n        companyName: job.company,\n        jobTitle: job.title,\n        tailoredConfigYaml: tailoredConfigYaml,\n        page: this.page,  // Pass page for Playwright PDF generation\n      });\n\n      log.info(`\u2705 Tailored resume generated: ${result.pdfPath}`);\n\n      // Clean up old resumes periodically (keep last 20)\n      this.cleanupOldResumes();\n\n      return result.pdfPath;\n\n    } catch (error) {\n      log.error(`Failed to generate tailored resume: ${error}`);\n      return null;\n    }\n  }\n\n  /**\n   * Clean up old tailored resumes to prevent disk space issues\n   * Keeps the most recent 20 resumes\n   */\n  private cleanupOldResumes(): void {\n    try {\n      const resumesDir = getTailoredResumesPath();\n      const files = fs.readdirSync(resumesDir)\n        .filter(f => f.endsWith('.pdf'))\n        .map(f => ({\n          name: f,\n          path: `${resumesDir}/${f}`,\n          time: fs.statSync(`${resumesDir}/${f}`).mtime.getTime()\n        }))\n        .sort((a, b) => b.time - a.time);\n\n      // Keep the 20 most recent, delete the rest\n      const toDelete = files.slice(20);\n      for (const file of toDelete) {\n        fs.unlinkSync(file.path);\n        // Also delete associated .yaml and _scores.json files\n        const yamlPath = file.path.replace('.pdf', '.yaml');\n        const scoresPath = file.path.replace('.pdf', '_scores.json');\n        if (fs.existsSync(yamlPath)) fs.unlinkSync(yamlPath);\n        if (fs.existsSync(scoresPath)) fs.unlinkSync(scoresPath);\n        log.debug(`Cleaned up old resume: ${file.name}`);\n      }\n\n      if (toDelete.length > 0) {\n        log.info(`\uD83E\uDDF9 Cleaned up ${toDelete.length} old tailored resumes`);\n      }\n    } catch (error) {\n      log.debug(`Error cleaning up old resumes: ${error}`);\n    }\n  }\n\n  /** Update configuration */\n  updateConfig(config: Partial<EasyApplierConfig>): void {\n    this.config = { ...this.config, ...config };\n    if (config.resumePath) this.formHandler.setResumePath(config.resumePath);\n    if (config.coverLetterPath) this.formHandler.setCoverLetterPath(config.coverLetterPath);\n  }\n\n  /** Check if a job has Easy Apply option */\n  async hasEasyApply(): Promise<boolean> {\n    try {\n      const btn = this.page.locator('button:has-text(\"Easy Apply\")').first();\n      return await btn.count() > 0 && await btn.isVisible();\n    } catch {\n      return false;\n    }\n  }\n}\n\n/**\n * Alias for compatibility with JobManager\n * JobManager imports this name specifically\n */\nexport { EasyApplier as LinkedInEasyApplier };\n"],
  "mappings": "AASA,SAAS,oBAAoB;AAC7B,SAAS,qBAAqB;AAC9B,SAAS,mBAAyC;AAClD,SAAS,yBAAyB;AAClC;AAAA,EACE;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,OACK;AACP,SAAS,eAAe,8BAA8B;AACtD,SAAS,8BAA8B;AACvC,YAAY,QAAQ;AAEpB,MAAM,MAAM,aAAa,aAAa;AA0BtC,MAAM,iBAAoC;AAAA,EACxC,UAAU;AAAA,EACV,YAAY;AAAA,EACZ,aAAa;AAAA,EACb,QAAQ;AACV;AAEO,MAAM,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAmBvB,YACE,MACA,aACA,eAA8B,CAAC,GAC/B,YACA,gBACA,UACA;AACA,SAAK,OAAO;AACZ,SAAK,cAAc;AACnB,SAAK,eAAe;AACpB,SAAK,iBAAiB;AACtB,SAAK,WAAW;AAChB,SAAK,SAAS;AAAA,MACZ,GAAG;AAAA,MACH;AAAA,IACF;AAGA,SAAK,cAAc,IAAI;AAAA,MACrB;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,KAAK,OAAO;AAAA,MACZ,KAAK,OAAO;AAAA,IACd;AAEA,SAAK,aAAa,IAAI,kBAAkB,IAAI;AAAA,EAC9C;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,SAAS,SAAiB,WAAmB,IAA4B;AACrF,WAAO,cAAc,KAAK,MAAM,SAAS,QAAQ;AAAA,EACnD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAaA,MAAM,MAAM,KAAoC;AAC9C,UAAM,SAA0B;AAAA,MAC9B,SAAS;AAAA,MACT,UAAU,IAAI;AAAA,MACd,SAAS,IAAI;AAAA,MACb,gBAAgB;AAAA,MAChB,aAAa;AAAA,MACb,cAAc;AAAA,IAChB;AAEA,QAAI,KAAK,mCAA4B,IAAI,KAAK,QAAQ,IAAI,OAAO,EAAE;AAEnE,QAAI;AAEF,UAAI,MAAM,2BAA2B,IAAI,IAAI,EAAE;AAC/C,YAAM,KAAK,KAAK,KAAK,IAAI,MAAM;AAAA,QAC7B,WAAW;AAAA,QACX,SAAS;AAAA,MACX,CAAC;AAGD,YAAM,KAAK,KAAK,iBAAiB,kBAAkB;AACnD,YAAM,KAAK,KAAK,eAAe,MAAO,KAAK,OAAO,IAAI,GAAG;AAEzD,UAAI,MAAM,iBAAiB;AAG3B,YAAM,KAAK,SAAS,mBAAmB,IAAI,KAAK;AAGhD,YAAM,iBAAiB,MAAM,KAAK,kBAAkB;AACpD,UAAI,gBAAgB;AAClB,YAAI,cAAc;AAClB,YAAI,MAAM,8BAA8B,eAAe,MAAM,QAAQ;AAAA,MACvE;AAGA,UAAI,KAAK,OAAO,mBAAmB;AACjC,YAAI,KAAK,sDAA+C;AAAA,MAC1D,WAAW,kBAAkB,KAAK,aAAa;AAC7C,YAAI;AACF,gBAAM,qBAAqB,MAAM,KAAK,uBAAuB,KAAK,cAAc;AAChF,cAAI,oBAAoB;AAEtB,iBAAK,YAAY,cAAc,kBAAkB;AACjD,gBAAI,KAAK,oCAA6B,kBAAkB,EAAE;AAAA,UAC5D;AAAA,QACF,SAAS,OAAO;AACd,cAAI,KAAK,4CAA4C,KAAK,EAAE;AAAA,QAC9D;AAAA,MACF;AAGA,YAAM,cAAc,MAAM,KAAK,mBAAmB;AAElD,UAAI,gBAAgB,mBAAmB;AACrC,eAAO,QAAQ;AACf,eAAO,iBAAiB;AACxB,YAAI,KAAK,qDAA2C;AACpD,eAAO;AAAA,MACT;AAEA,UAAI,gBAAgB,UAAU;AAC5B,eAAO,QAAQ;AACf,YAAI,MAAM,OAAO,KAAK;AACtB,cAAM,KAAK,eAAe;AAC1B,eAAO;AAAA,MACT;AAGA,YAAM,KAAK,cAAc,GAAG;AAG5B,YAAM,gBAAgB,MAAM,KAAK,gBAAgB,MAAM;AAEvD,UAAI,CAAC,cAAc,SAAS;AAC1B,eAAO,QAAQ,cAAc;AAC7B,cAAM,KAAK,eAAe;AAC1B,eAAO;AAAA,MACT;AAIA,UAAI,CAAC,KAAK,OAAO,QAAQ;AACvB,eAAO,UAAU,cAAc;AAAA,MACjC,OAAO;AACL,YAAI,KAAK,iEAA0D;AACnE,eAAO,UAAU;AACjB,cAAM,KAAK,WAAW,WAAW;AAAA,MACnC;AAEA,UAAI,OAAO,SAAS;AAClB,YAAI,KAAK,mCAA8B,IAAI,KAAK,QAAQ,IAAI,OAAO,EAAE;AAAA,MACvE;AAAA,IAEF,SAAS,OAAO;AACd,aAAO,QAAQ,OAAO,KAAK;AAC3B,UAAI,MAAM,4BAA4B,KAAK,EAAE;AAC7C,YAAM,KAAK,SAAS,eAAe,OAAO,QAAQ;AAClD,YAAM,KAAK,eAAe;AAAA,IAC5B;AAEA,WAAO;AAAA,EACT;AAAA;AAAA,EAGA,MAAc,mBAAqC;AACjD,QAAI;AACF,iBAAW,YAAY,2BAA2B;AAChD,YAAI;AACF,gBAAM,YAAY,KAAK,KAAK,QAAQ,QAAQ,EAAE,MAAM;AACpD,cAAI,MAAM,UAAU,MAAM,IAAI,KAAK,MAAM,UAAU,UAAU,GAAG;AAC9D,gBAAI,KAAK,uCAAuC;AAChD,mBAAO;AAAA,UACT;AAAA,QACF,QAAQ;AAAA,QAAiB;AAAA,MAC3B;AACA,aAAO;AAAA,IACT,QAAQ;AACN,aAAO;AAAA,IACT;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAc,qBAAuE;AACnF,QAAI;AACF,UAAI,MAAM,KAAK,iBAAiB,GAAG;AACjC,YAAI,KAAK,gCAAgC;AACzC,eAAO;AAAA,MACT;AAEA,YAAM,KAAK,SAAS,oBAAoB;AAGxC,UAAI;AACJ,UAAI,cAAc;AAElB,iBAAW,YAAY,6BAA6B;AAClD,YAAI;AACF,gBAAM,UAAU,KAAK,KAAK,QAAQ,QAAQ;AAC1C,gBAAM,QAAQ,MAAM,EAAE,QAAQ,EAAE,OAAO,YAAY,SAAS,IAAK,CAAC,EAAE,MAAM,MAAM;AAAA,UAAC,CAAC;AAElF,qBAAW,UAAU,MAAM,QAAQ,IAAI,GAAG;AACxC,gBAAI;AACF,kBAAI,MAAM,OAAO,UAAU,KAAK,MAAM,OAAO,UAAU,GAAG;AACxD,kCAAkB;AAClB,+BAAe,MAAM,OAAO,YAAY,IAAI,KAAK,KACpC,MAAM,OAAO,aAAa,YAAY,KAAK;AACxD,oBAAI,KAAK,mCAA8B,QAAQ,EAAE;AACjD;AAAA,cACF;AAAA,YACF,QAAQ;AAAE;AAAA,YAAU;AAAA,UACtB;AACA,cAAI,gBAAiB;AAAA,QACvB,QAAQ;AAAE;AAAA,QAAU;AAAA,MACtB;AAEA,UAAI,CAAC,iBAAiB;AACpB,YAAI,KAAK,6BAA6B;AACtC,cAAM,KAAK,SAAS,kBAAkB;AACtC,eAAO;AAAA,MACT;AAGA,YAAM,OAAO,MAAM,gBAAgB,aAAa,MAAM;AACtD,UAAI,MAAM;AACR,YAAI,KAAK,yBAAyB;AAClC,cAAM,KAAK,KAAK,KAAK,MAAM,EAAE,WAAW,oBAAoB,SAAS,IAAM,CAAC;AAAA,MAC9E,OAAO;AACL,YAAI,KAAK,4BAA4B;AACrC,cAAM,gBAAgB,MAAM;AAAA,MAC9B;AAGA,UAAI,KAAK,iCAAiC;AAC1C,YAAM,cAAc;AACpB,UAAI,aAAa;AAEjB,eAAS,UAAU,GAAG,WAAW,aAAa,WAAW;AACvD,cAAM,gBAAgB,MAAM,KAAK,KAAK,QAAQ,MAAM,SAAS,EAAE,IAAI;AAEnE,YAAI,cAAc,SAAS,GAAG;AAC5B,cAAI;AACF,kBAAM,KAAK,KAAK,gBAAgB,MAAM,WAAW,EAAE,SAAS,KAAO,OAAO,UAAU,CAAC;AACrF,yBAAa;AACb,gBAAI,KAAK,iCAA4B;AACrC;AAAA,UACF,QAAQ;AACN,gBAAI,UAAU,YAAa,OAAM,KAAK,KAAK,eAAe,GAAI;AAAA,UAChE;AAAA,QACF,OAAO;AACL,cAAI,UAAU,YAAa,OAAM,KAAK,KAAK,eAAe,GAAI;AAAA,QAChE;AAAA,MACF;AAEA,UAAI,CAAC,YAAY;AACf,YAAI,MAAM,iCAAiC;AAC3C,cAAM,KAAK,SAAS,kBAAkB;AACtC,eAAO;AAAA,MACT;AAEA,YAAM,KAAK,WAAW,kBAAkB;AACxC,YAAM,KAAK,SAAS,cAAc;AAClC,aAAO;AAAA,IAET,SAAS,OAAO;AACd,UAAI,MAAM,oCAAoC,KAAK,EAAE;AACrD,YAAM,KAAK,SAAS,kBAAkB;AACtC,aAAO;AAAA,IACT;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,cAAc,KAAyB;AACnD,QAAI;AACF,YAAM,UAAU;AAAA,aACT,IAAI,KAAK;AAAA,WACX,IAAI,OAAO;AAAA,YACV,IAAI,QAAQ;AAAA,eACT,IAAI,aAAa,UAAU,GAAG,GAAG,KAAK,KAAK;AAAA,QAClD,KAAK;AAEP,YAAM,KAAK,YAAY,cAAc,OAAO;AAC5C,UAAI,MAAM,yBAAyB;AAAA,IACrC,QAAQ;AAAA,IAER;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYA,MAAc,gBAAgB,QAAwE;AACpG,QAAI,UAAU;AACd,QAAI,OAAO;AAEX,WAAO,OAAO,KAAK,OAAO,UAAU;AAClC;AACA,UAAI,KAAK,8BAA8B,IAAI,aAAa;AAGxD,YAAM,KAAK,SAAS,QAAQ,IAAI,QAAQ;AAGxC,YAAM,cAAc,MAAM,KAAK,WAAW,YAAY;AACtD,UAAI,CAAC,aAAa;AAChB,YAAI,KAAK,qCAAqC;AAC9C,eAAO,EAAE,SAAS,KAAK;AAAA,MACzB;AAGA,UAAI,MAAM,QAAQ,IAAI,yBAAyB;AAC/C,YAAM,aAAa,MAAM,KAAK,YAAY,gBAAgB;AAC1D,aAAO,eAAe,WAAW;AACjC,aAAO,gBAAgB,WAAW;AAElC,UAAI,KAAK,uBAAuB,WAAW,kBAAkB,WAAW,YAAY,IAAI,WAAW,eAAe,gBAAgB;AAGlI,YAAM,KAAK,SAAS,QAAQ,IAAI,aAAa;AAG7C,UAAI,MAAM,QAAQ,IAAI,oCAAoC;AAC1D,YAAM,YAAY,MAAM,KAAK,WAAW,mBAAmB;AAE3D,UAAI,CAAC,UAAU,SAAS;AAEtB,cAAM,KAAK,SAAS,QAAQ,IAAI,YAAY;AAG5C,YAAI,MAAM,KAAK,WAAW,oBAAoB,GAAG;AAC/C;AACA,cAAI,UAAU,KAAK,OAAO,YAAY;AACpC,kBAAM,SAAS,MAAM,KAAK,WAAW,oBAAoB;AACzD,kBAAM,KAAK,SAAS,QAAQ,IAAI,oBAAoB;AACpD,mBAAO;AAAA,cACL,SAAS;AAAA,cACT,OAAO,sBAAsB,OAAO,KAAK,IAAI,CAAC;AAAA,YAChD;AAAA,UACF;AACA,cAAI,KAAK,6BAA6B,IAAI,WAAW,OAAO,IAAI,KAAK,OAAO,UAAU,EAAE;AACxF;AAAA,QACF;AAEA,eAAO,EAAE,SAAS,OAAO,OAAO,UAAU,SAAS,oBAAoB;AAAA,MACzE;AAGA,UAAI,UAAU,WAAW;AACvB,YAAI,KAAK,2CAAsC;AAC/C,cAAM,KAAK,SAAS,mBAAmB;AACvC,eAAO,iBAAiB;AAGxB,cAAM,KAAK,iBAAiB;AAE5B,eAAO,EAAE,SAAS,KAAK;AAAA,MACzB;AAIA,YAAM,KAAK,KAAK,eAAe,GAAI;AAEnC,YAAM,YAAY,MAAM,KAAK,WAAW,YAAY;AACpD,UAAI,CAAC,WAAW;AACd,YAAI,KAAK,sDAAsD;AAC/D,eAAO,iBAAiB;AACxB,eAAO,EAAE,SAAS,KAAK;AAAA,MACzB;AAGA,aAAO,iBAAiB;AACxB,gBAAU;AAGV,YAAM,KAAK,WAAW,kBAAkB;AAAA,IAC1C;AAEA,WAAO,EAAE,SAAS,OAAO,OAAO,2BAA2B,KAAK,OAAO,QAAQ,IAAI;AAAA,EACrF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,MAAc,mBAAkE;AAE9E,UAAM,SAAS,MAAM,KAAK,WAAW,mBAAmB;AAExD,QAAI,OAAO,WAAW,OAAO,WAAW;AACtC,YAAM,KAAK,iBAAiB;AAC5B,aAAO,EAAE,SAAS,KAAK;AAAA,IACzB;AAEA,WAAO,EAAE,SAAS,OAAO,SAAS,OAAO,OAAO,MAAM;AAAA,EACxD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,MAAc,mBAAkC;AAC9C,QAAI;AACF,UAAI,KAAK,0DAA0D;AAGnE,YAAM,KAAK,KAAK,eAAe,GAAI;AAGnC,UAAI;AACF,cAAM,KAAK,KAAK,gBAAgB,2CAA2C,EAAE,SAAS,IAAK,CAAC;AAC5F,YAAI,KAAK,2CAAsC;AAAA,MACjD,QAAQ;AACN,YAAI,MAAM,wEAAwE;AAAA,MACpF;AAAA,IAEF,SAAS,OAAO;AACd,UAAI,KAAK,4CAA4C,KAAK,EAAE;AAE5D,UAAI,KAAK,kDAAkD;AAAA,IAC7D;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,iBAAgC;AAC5C,QAAI;AACF,UAAI,MAAM,KAAK,WAAW,YAAY,GAAG;AACvC,cAAM,KAAK,WAAW,WAAW;AAAA,MACnC;AAAA,IACF,QAAQ;AAAA,IAAe;AAAA,EACzB;AAAA;AAAA,EAGA,MAAc,oBAAqC;AACjD,QAAI;AAEF,UAAI;AACF,cAAM,UAAU,KAAK,KAAK;AAAA,UACxB;AAAA,QACF,EAAE,MAAM;AACR,YAAI,MAAM,QAAQ,UAAU,GAAG;AAC7B,gBAAM,QAAQ,MAAM;AACpB,gBAAM,KAAK,KAAK,eAAe,GAAG;AAAA,QACpC;AAAA,MACF,QAAQ;AAAA,MAAkB;AAG1B,iBAAW,YAAY,2BAA2B;AAChD,YAAI;AACF,gBAAM,UAAU,KAAK,KAAK,QAAQ,QAAQ,EAAE,MAAM;AAClD,gBAAM,QAAQ,QAAQ,EAAE,OAAO,YAAY,SAAS,IAAK,CAAC;AAC1D,gBAAM,OAAO,MAAM,QAAQ,YAAY;AACvC,cAAI,MAAM,KAAK,GAAG;AAChB,gBAAI,MAAM,sBAAsB,KAAK,MAAM,SAAS;AACpD,mBAAO,KAAK,KAAK;AAAA,UACnB;AAAA,QACF,QAAQ;AAAE;AAAA,QAAU;AAAA,MACtB;AAEA,UAAI,KAAK,gCAAgC;AACzC,aAAO;AAAA,IACT,SAAS,OAAO;AACd,UAAI,MAAM,qCAAqC,KAAK,EAAE;AACtD,aAAO;AAAA,IACT;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYA,MAAc,uBAAuB,KAAU,gBAAgD;AAC7F,QAAI;AAEF,YAAM,iBAAiB,cAAc;AACrC,UAAI,CAAC,GAAG,WAAW,cAAc,GAAG;AAClC,YAAI,MAAM,4BAA4B,cAAc,EAAE;AACtD,YAAI,MAAM,oDAAoD;AAC9D,eAAO;AAAA,MACT;AAEA,UAAI,KAAK,kCAA2B,IAAI,OAAO,MAAM,IAAI,KAAK,EAAE;AAChE,UAAI,MAAM,6BAA6B,cAAc,EAAE;AAGvD,YAAM,iBAAiB,GAAG,aAAa,gBAAgB,OAAO;AAG9D,YAAM,qBAAqB,MAAM,KAAK,YAAY;AAAA,QAChD;AAAA,QACA;AAAA,MACF;AAEA,UAAI,CAAC,sBAAsB,mBAAmB,SAAS,KAAK;AAC1D,YAAI,MAAM,2CAA2C;AACrD,eAAO;AAAA,MACT;AAGA,YAAM,SAAS,MAAM,uBAAuB;AAAA,QAC1C,aAAa,IAAI;AAAA,QACjB,UAAU,IAAI;AAAA,QACd;AAAA,QACA,MAAM,KAAK;AAAA;AAAA,MACb,CAAC;AAED,UAAI,KAAK,qCAAgC,OAAO,OAAO,EAAE;AAGzD,WAAK,kBAAkB;AAEvB,aAAO,OAAO;AAAA,IAEhB,SAAS,OAAO;AACd,UAAI,MAAM,uCAAuC,KAAK,EAAE;AACxD,aAAO;AAAA,IACT;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMQ,oBAA0B;AAChC,QAAI;AACF,YAAM,aAAa,uBAAuB;AAC1C,YAAM,QAAQ,GAAG,YAAY,UAAU,EACpC,OAAO,OAAK,EAAE,SAAS,MAAM,CAAC,EAC9B,IAAI,QAAM;AAAA,QACT,MAAM;AAAA,QACN,MAAM,GAAG,UAAU,IAAI,CAAC;AAAA,QACxB,MAAM,GAAG,SAAS,GAAG,UAAU,IAAI,CAAC,EAAE,EAAE,MAAM,QAAQ;AAAA,MACxD,EAAE,EACD,KAAK,CAAC,GAAG,MAAM,EAAE,OAAO,EAAE,IAAI;AAGjC,YAAM,WAAW,MAAM,MAAM,EAAE;AAC/B,iBAAW,QAAQ,UAAU;AAC3B,WAAG,WAAW,KAAK,IAAI;AAEvB,cAAM,WAAW,KAAK,KAAK,QAAQ,QAAQ,OAAO;AAClD,cAAM,aAAa,KAAK,KAAK,QAAQ,QAAQ,cAAc;AAC3D,YAAI,GAAG,WAAW,QAAQ,EAAG,IAAG,WAAW,QAAQ;AACnD,YAAI,GAAG,WAAW,UAAU,EAAG,IAAG,WAAW,UAAU;AACvD,YAAI,MAAM,0BAA0B,KAAK,IAAI,EAAE;AAAA,MACjD;AAEA,UAAI,SAAS,SAAS,GAAG;AACvB,YAAI,KAAK,wBAAiB,SAAS,MAAM,uBAAuB;AAAA,MAClE;AAAA,IACF,SAAS,OAAO;AACd,UAAI,MAAM,kCAAkC,KAAK,EAAE;AAAA,IACrD;AAAA,EACF;AAAA;AAAA,EAGA,aAAa,QAA0C;AACrD,SAAK,SAAS,EAAE,GAAG,KAAK,QAAQ,GAAG,OAAO;AAC1C,QAAI,OAAO,WAAY,MAAK,YAAY,cAAc,OAAO,UAAU;AACvE,QAAI,OAAO,gBAAiB,MAAK,YAAY,mBAAmB,OAAO,eAAe;AAAA,EACxF;AAAA;AAAA,EAGA,MAAM,eAAiC;AACrC,QAAI;AACF,YAAM,MAAM,KAAK,KAAK,QAAQ,+BAA+B,EAAE,MAAM;AACrE,aAAO,MAAM,IAAI,MAAM,IAAI,KAAK,MAAM,IAAI,UAAU;AAAA,IACtD,QAAQ;AACN,aAAO;AAAA,IACT;AAAA,EACF;AACF;",
  "names": []
}
