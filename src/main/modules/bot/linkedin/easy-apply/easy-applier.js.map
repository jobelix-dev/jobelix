{
  "version": 3,
  "sources": ["easy-applier.ts"],
  "sourcesContent": ["/**\n * Easy Applier - Main coordinator for LinkedIn Easy Apply applications\n * \n * This is the top-level class that:\n * 1. Opens the Easy Apply modal\n * 2. Navigates through all pages of the application\n * 3. Fills forms using FormHandler\n * 4. Handles navigation using NavigationHandler\n * 5. Submits the application\n * 6. Reports status and errors\n * \n * The application process flow:\n * 1. Click Easy Apply button on job posting\n * 2. Modal opens with multi-page form\n * 3. Fill each page \u2192 Click Next\n * 4. Review page \u2192 Click Review\n * 5. Final page \u2192 Click Submit\n * 6. Success confirmation\n */\n\nimport type { Page } from 'playwright';\nimport type { SavedAnswer, Job } from '../../types';\nimport type { StatusReporter } from '../../utils/status-reporter';\nimport { createLogger } from '../../utils/logger';\nimport { FormHandler, AnswerRecordCallback } from './form-handler';\nimport { NavigationHandler, ModalState } from './navigation';\n\nconst log = createLogger('EasyApplier');\n\n/**\n * Result of an Easy Apply attempt\n */\nexport interface EasyApplyResult {\n  success: boolean;\n  jobTitle: string;\n  company: string;\n  error?: string;\n  pagesCompleted: number;\n  totalFields: number;\n  failedFields: number;\n}\n\n/**\n * Configuration for Easy Applier\n */\nexport interface EasyApplierConfig {\n  maxPages: number;              // Maximum pages before giving up (safety limit)\n  maxRetries: number;            // Retries per page on error\n  resumePath?: string;           // Path to resume PDF\n  coverLetterPath?: string;      // Path to cover letter PDF\n  skipOnError: boolean;          // Skip application if errors can't be resolved\n  dryRun: boolean;               // If true, don't actually submit (stop at review)\n}\n\nconst DEFAULT_CONFIG: EasyApplierConfig = {\n  maxPages: 15,\n  maxRetries: 3,\n  skipOnError: true,\n  dryRun: false,\n};\n\nexport class EasyApplier {\n  private page: Page;\n  private gptAnswerer: any;\n  private formHandler: FormHandler;\n  private navHandler: NavigationHandler;\n  private config: EasyApplierConfig;\n  private savedAnswers: SavedAnswer[];\n  private recordCallback?: AnswerRecordCallback;\n  private reporter?: StatusReporter;\n\n  /**\n   * Create a new Easy Applier instance\n   * \n   * Constructor signature matches LinkedInJobManager expectations:\n   * - page: Playwright page\n   * - gptAnswerer: AI for form responses\n   * - savedAnswers: Previously saved Q&A\n   * - resumePath: Path to resume file\n   * - recordCallback: Callback for persisting answers\n   * - reporter: Status reporter for IPC\n   * \n   * @param page - Playwright page with job posting open\n   * @param gptAnswerer - GPT answerer for generating form responses\n   * @param savedAnswers - Previously saved Q&A pairs\n   * @param resumePath - Path to resume PDF file\n   * @param recordCallback - Callback to persist new answers\n   * @param reporter - Status reporter for UI updates\n   */\n  constructor(\n    page: Page,\n    gptAnswerer: any,\n    savedAnswers: SavedAnswer[] = [],\n    resumePath?: string,\n    recordCallback?: AnswerRecordCallback,\n    reporter?: StatusReporter\n  ) {\n    this.page = page;\n    this.gptAnswerer = gptAnswerer;\n    this.savedAnswers = savedAnswers;\n    this.recordCallback = recordCallback;\n    this.reporter = reporter;\n    this.config = { \n      ...DEFAULT_CONFIG, \n      resumePath \n    };\n    \n    // Initialize handlers\n    this.formHandler = new FormHandler(\n      page,\n      gptAnswerer,\n      savedAnswers,\n      recordCallback,\n      this.config.resumePath,\n      this.config.coverLetterPath\n    );\n    \n    this.navHandler = new NavigationHandler(page);\n  }\n\n  /**\n   * Apply to a job using Easy Apply\n   * \n   * This is the main entry point. It:\n   * 1. Opens the Easy Apply modal\n   * 2. Loops through all form pages\n   * 3. Submits the application\n   * \n   * @param job - Job to apply to\n   * @returns Result of the application attempt\n   */\n  async apply(job: Job): Promise<EasyApplyResult> {\n    const result: EasyApplyResult = {\n      success: false,\n      jobTitle: job.title,\n      company: job.company,\n      pagesCompleted: 0,\n      totalFields: 0,\n      failedFields: 0,\n    };\n\n    log.info(`\uD83C\uDFAF Starting Easy Apply: \"${job.title}\" at ${job.company}`);\n\n    try {\n      // Step 1: Open the Easy Apply modal\n      const modalOpened = await this.openEasyApplyModal();\n      if (!modalOpened) {\n        result.error = 'Could not open Easy Apply modal';\n        log.error(result.error);\n        return result;\n      }\n\n      // Step 2: Set the job context for GPT (helps with relevant answers)\n      await this.setJobContext(job);\n\n      // Step 3: Process all pages until submission\n      const processResult = await this.processAllPages(result);\n      \n      if (!processResult.success) {\n        result.error = processResult.error;\n        await this.cleanupFailure();\n        return result;\n      }\n\n      // Step 4: Handle final submission\n      if (!this.config.dryRun) {\n        const submitResult = await this.handleSubmission();\n        result.success = submitResult.success;\n        if (!submitResult.success) {\n          result.error = submitResult.error;\n        }\n      } else {\n        log.info('\uD83E\uDDEA Dry run mode - skipping actual submission');\n        result.success = true;\n        await this.navHandler.closeModal();\n      }\n\n      if (result.success) {\n        log.info(`\u2705 Successfully applied to \"${job.title}\" at ${job.company}`);\n      }\n\n    } catch (error) {\n      result.error = String(error);\n      log.error(`Error during Easy Apply: ${error}`);\n      await this.cleanupFailure();\n    }\n\n    return result;\n  }\n\n  /**\n   * Open the Easy Apply modal on the current job page\n   */\n  private async openEasyApplyModal(): Promise<boolean> {\n    try {\n      // Find Easy Apply button\n      const easyApplySelectors = [\n        'button.jobs-apply-button',\n        'button[data-control-name=\"jobdetails_topcard_inapply\"]',\n        'button:has-text(\"Easy Apply\")',\n        '.jobs-s-apply button',\n      ];\n\n      let easyApplyButton;\n      for (const selector of easyApplySelectors) {\n        const btn = this.page.locator(selector).first();\n        if (await btn.count() > 0 && await btn.isVisible()) {\n          easyApplyButton = btn;\n          break;\n        }\n      }\n\n      if (!easyApplyButton) {\n        log.warn('Easy Apply button not found');\n        return false;\n      }\n\n      // Click to open modal\n      await easyApplyButton.click();\n      \n      // Wait for modal to appear\n      await this.page.waitForSelector('[data-test-modal]', { timeout: 10000 });\n      await this.navHandler.waitForModalReady();\n\n      log.debug('Easy Apply modal opened');\n      return true;\n\n    } catch (error) {\n      log.error(`Failed to open Easy Apply modal: ${error}`);\n      return false;\n    }\n  }\n\n  /**\n   * Set job context for GPT to provide better answers\n   */\n  private async setJobContext(job: Job): Promise<void> {\n    try {\n      const context = `\nJob Title: ${job.title}\nCompany: ${job.company}\nLocation: ${job.location}\nDescription: ${job.description?.substring(0, 500) || 'N/A'}\n      `.trim();\n\n      await this.gptAnswerer.setJobContext(context);\n      log.debug('Job context set for GPT');\n    } catch {\n      // Ignore - GPT answerer might not support this\n    }\n  }\n\n  /**\n   * Process all pages of the Easy Apply form\n   */\n  private async processAllPages(result: EasyApplyResult): Promise<{ success: boolean; error?: string }> {\n    let retries = 0;\n    \n    while (result.pagesCompleted < this.config.maxPages) {\n      // Get current modal state\n      const state = await this.navHandler.getModalState();\n      log.debug(`Page ${result.pagesCompleted + 1}, state: ${state}`);\n\n      // Check for terminal states\n      if (state === 'success') {\n        return { success: true };\n      }\n\n      if (state === 'submit') {\n        // Ready to submit\n        return { success: true };\n      }\n\n      if (state === 'closed') {\n        return { success: false, error: 'Modal was closed unexpectedly' };\n      }\n\n      if (state === 'unknown') {\n        retries++;\n        if (retries > this.config.maxRetries) {\n          return { success: false, error: 'Unable to determine modal state' };\n        }\n        await this.page.waitForTimeout(1000);\n        continue;\n      }\n\n      // Fill the current page\n      const pageResult = await this.formHandler.fillCurrentPage();\n      result.totalFields += pageResult.fieldsProcessed;\n      result.failedFields += pageResult.fieldsFailed;\n\n      // Navigate to next page\n      let navResult;\n      if (state === 'review') {\n        navResult = await this.navHandler.clickReview();\n      } else {\n        navResult = await this.navHandler.clickNext();\n      }\n\n      if (!navResult.success) {\n        // Navigation failed - might have validation errors\n        if (await this.navHandler.hasValidationErrors()) {\n          retries++;\n          if (retries > this.config.maxRetries) {\n            const errors = await this.navHandler.getValidationErrors();\n            return { \n              success: false, \n              error: `Validation errors: ${errors.join(', ')}` \n            };\n          }\n          log.warn(`Validation errors, retry ${retries}/${this.config.maxRetries}`);\n          continue;\n        }\n        \n        return { success: false, error: navResult.error };\n      }\n\n      // Successfully moved to next page\n      result.pagesCompleted++;\n      retries = 0;\n      \n      // Wait for page transition\n      await this.navHandler.waitForModalReady();\n    }\n\n    return { success: false, error: `Exceeded maximum pages (${this.config.maxPages})` };\n  }\n\n  /**\n   * Handle the final submission step\n   */\n  private async handleSubmission(): Promise<{ success: boolean; error?: string }> {\n    const state = await this.navHandler.getModalState();\n    \n    if (state !== 'submit') {\n      log.warn(`Expected submit state, got: ${state}`);\n      // Try to continue anyway\n    }\n\n    const result = await this.navHandler.clickSubmit();\n    \n    if (result.success) {\n      // Wait for confirmation\n      await this.page.waitForTimeout(2000);\n      \n      // Close success dialog if present\n      const closeButton = this.page.locator('button[aria-label*=\"Dismiss\"]').first();\n      if (await closeButton.count() > 0) {\n        await closeButton.click();\n      }\n    }\n\n    return { success: result.success, error: result.error };\n  }\n\n  /**\n   * Clean up after a failed application\n   */\n  private async cleanupFailure(): Promise<void> {\n    try {\n      if (await this.navHandler.isModalOpen()) {\n        await this.navHandler.closeModal();\n      }\n    } catch {\n      // Ignore cleanup errors\n    }\n  }\n\n  /**\n   * Update configuration\n   */\n  updateConfig(config: Partial<EasyApplierConfig>): void {\n    this.config = { ...this.config, ...config };\n    \n    if (config.resumePath) {\n      this.formHandler.setResumePath(config.resumePath);\n    }\n    if (config.coverLetterPath) {\n      this.formHandler.setCoverLetterPath(config.coverLetterPath);\n    }\n  }\n\n  /**\n   * Check if a job has Easy Apply option\n   */\n  async hasEasyApply(): Promise<boolean> {\n    try {\n      const easyApplyButton = this.page.locator('button:has-text(\"Easy Apply\")').first();\n      return await easyApplyButton.count() > 0 && await easyApplyButton.isVisible();\n    } catch {\n      return false;\n    }\n  }\n}\n\n/**\n * Alias for compatibility with JobManager\n * JobManager imports this name specifically\n */\nexport { EasyApplier as LinkedInEasyApplier };\n"],
  "mappings": "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",
  "names": []
}
