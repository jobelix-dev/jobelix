{
  "version": 3,
  "sources": ["authenticator.ts"],
  "sourcesContent": ["/**\n * LinkedIn Authenticator - Handles manual login flow\n * \n * Waits for user to manually log in through the browser.\n * Mirrors the Python LinkedInAuthenticator class.\n */\n\nimport type { Page } from 'playwright';\nimport { createLogger } from '../utils/logger';\nimport { StatusReporter } from '../utils/status-reporter';\nimport { isBrowserClosed } from '../utils/browser-utils';\n\nconst log = createLogger('Authenticator');\n\nexport class LinkedInAuthenticator {\n  constructor(\n    private page: Page,\n    private reporter?: StatusReporter\n  ) {}\n\n  /**\n   * Start the authentication process\n   */\n  async start(): Promise<void> {\n    log.info('Starting LinkedIn authentication process');\n    \n    try {\n      await this.page.goto('https://www.linkedin.com', {\n        waitUntil: 'domcontentloaded',\n        timeout: 60000,\n      });\n      log.debug('Successfully navigated to LinkedIn.com');\n    } catch (error) {\n      if (isBrowserClosed(error)) {\n        log.error('Browser was closed during LinkedIn navigation');\n        throw new Error('Browser closed - stopping bot');\n      }\n      throw error;\n    }\n\n    await this.waitForPageLoad();\n\n    if (!await this.isLoggedIn()) {\n      log.info('Not logged in, initiating login process...');\n      await this.handleLogin();\n    } else {\n      log.info('Already logged in to LinkedIn');\n    }\n  }\n\n  /**\n   * Handle the complete login flow\n   */\n  private async handleLogin(): Promise<void> {\n    log.info('Starting login workflow');\n    log.info('Please enter your LinkedIn credentials manually in the browser window.');\n    log.info('The bot will wait until you reach the feed page before starting job applications.');\n\n    try {\n      await this.page.goto('https://www.linkedin.com/login', {\n        waitUntil: 'domcontentloaded',\n        timeout: 60000,\n      });\n      log.debug('Successfully navigated to login page');\n    } catch (error) {\n      if (isBrowserClosed(error)) {\n        log.error('Browser was closed during login navigation');\n        throw new Error('Browser closed - stopping bot');\n      }\n      throw error;\n    }\n\n    // Wait indefinitely for user to log in\n    log.info('\u23F3 Waiting for you to log in and reach the feed page... (no timeout)');\n    let lastUrlCheck = '';\n    let lastStatusTime = 0;\n\n    while (true) {\n      try {\n        const currentUrl = this.page.url();\n\n        // Log URL changes only when it actually changes\n        if (currentUrl !== lastUrlCheck) {\n          log.debug(`Current URL: ${currentUrl}`);\n          lastUrlCheck = currentUrl;\n        }\n\n        // Check if user has reached the feed page or any logged-in page\n        if (this.isLoggedInUrl(currentUrl)) {\n          // Double-check by waiting a moment\n          await this.page.waitForTimeout(2000);\n          const confirmedUrl = this.page.url();\n          log.debug(`Confirmed URL after 2s: ${confirmedUrl}`);\n\n          if (this.isLoggedInUrl(confirmedUrl)) {\n            log.info(`\u2705 Login successful - reached: ${confirmedUrl}`);\n            break;\n          }\n        }\n\n        // Check if we're still on login page but nav bar appeared\n        if (currentUrl.includes('/login') || currentUrl.includes('/uas/login')) {\n          const navBarVisible = await this.isNavBarVisible();\n          if (navBarVisible) {\n            log.info('\u2705 Login detected via navigation bar - redirecting to feed...');\n            await this.page.goto('https://www.linkedin.com/feed/', {\n              waitUntil: 'domcontentloaded',\n              timeout: 30000,\n            });\n            await this.page.waitForTimeout(2000);\n            log.info('\u2705 Successfully navigated to feed page');\n            break;\n          }\n        }\n\n        // Print a waiting message every 10 seconds\n        const now = Date.now();\n        if (now - lastStatusTime > 10000) {\n          log.info('Still waiting for login and feed page... (please log in and wait for feed)');\n          lastStatusTime = now;\n        }\n\n      } catch (error) {\n        if (isBrowserClosed(error)) {\n          log.error('Browser was closed during login waiting loop');\n          throw new Error('Browser closed - stopping bot');\n        }\n        throw error;\n      }\n\n      await this.page.waitForTimeout(1000);\n    }\n\n    // Handle any security challenges\n    log.debug('Checking for security challenges');\n    await this.handleSecurityCheck();\n    log.info('Login workflow completed successfully');\n  }\n\n  /**\n   * Handle LinkedIn security challenges\n   */\n  private async handleSecurityCheck(maxWaitMinutes = 5): Promise<void> {\n    log.debug('Checking for security challenges...');\n    const endTime = Date.now() + maxWaitMinutes * 60 * 1000;\n\n    while (Date.now() < endTime) {\n      const currentUrl = this.page.url();\n\n      // Check if we've successfully reached the feed page\n      if (currentUrl.includes('/feed')) {\n        log.info('Security check cleared - landed on the feed page');\n        return;\n      }\n\n      // Check if we're on a checkpoint page\n      if (currentUrl.includes('/checkpoint/')) {\n        log.warn('Security checkpoint detected. Please solve it in the open browser tab...');\n        log.info('Waiting for manual completion...');\n      }\n\n      await this.page.waitForTimeout(5000);\n    }\n\n    throw new Error('Login aborted: security checkpoint not passed within time limit');\n  }\n\n  /**\n   * Check if the user is already logged in\n   * Mirrors Python's is_logged_in() method\n   */\n  async isLoggedIn(): Promise<boolean> {\n    try {\n      log.debug('Checking if already logged in (no navigation)...');\n      const currentUrl = this.page.url();\n\n      // If we're on a logged-in page (feed, mynetwork, profile)\n      if (currentUrl.includes('/feed') || currentUrl.includes('/mynetwork') || currentUrl.includes('/in/')) {\n        log.debug('User is on a logged-in page');\n        return true;\n      }\n      \n      // If we're on the homepage, check for nav bar\n      if (currentUrl.endsWith('linkedin.com/') || currentUrl === 'https://www.linkedin.com') {\n        const navBarVisible = await this.isNavBarVisible();\n        if (navBarVisible) {\n          log.debug('Navigation bar detected on homepage - user appears logged in');\n          return true;\n        }\n      }\n\n      // If on login page, check if nav bar appeared (form submitted)\n      if (currentUrl.includes('/login')) {\n        const navBarVisible = await this.isNavBarVisible();\n        if (navBarVisible) {\n          log.debug('Navigation bar detected - user appears logged in');\n          return true;\n        }\n        return false;\n      }\n\n      // On checkpoint page, not logged in yet\n      if (currentUrl.includes('/checkpoint')) {\n        return false;\n      }\n\n      // Try to detect nav bar as fallback for any other page\n      const navBarVisible = await this.isNavBarVisible();\n      if (navBarVisible) {\n        log.debug('Navigation bar detected - user appears logged in');\n        return true;\n      }\n\n    } catch (error) {\n      log.debug(`Login verification failed: ${error}`);\n    }\n\n    return false;\n  }\n\n  /**\n   * Check if current URL indicates logged-in state\n   * Note: Only /feed, /mynetwork, and linkedin.com homepage indicate logged-in\n   * DO NOT include /jobs as that's a public page\n   */\n  private isLoggedInUrl(url: string): boolean {\n    return url.includes('/feed') || \n           url.includes('/mynetwork') || \n           url.includes('/in/') ||  // User profile pages\n           url.endsWith('linkedin.com/');\n  }\n\n  /**\n   * Check if LinkedIn's navigation bar is visible\n   */\n  private async isNavBarVisible(): Promise<boolean> {\n    try {\n      const navBar = this.page.locator('nav.global-nav');\n      return await navBar.isVisible({ timeout: 1000 });\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Wait for page to load\n   */\n  private async waitForPageLoad(timeout = 10): Promise<void> {\n    try {\n      await this.page.waitForLoadState('domcontentloaded', { timeout: timeout * 1000 });\n      log.debug('Page loaded successfully');\n    } catch {\n      log.warn('Page load timed out, continuing anyway');\n    }\n  }\n}\n"],
  "mappings": "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",
  "names": ["navBarVisible"]
}
