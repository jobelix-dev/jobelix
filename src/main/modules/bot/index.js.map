{
  "version": 3,
  "sources": ["index.ts"],
  "sourcesContent": ["/**\n * LinkedIn Auto Apply Bot - Main Entry Point\n * \n * This is the Node.js rewrite of the Python bot, running directly in Electron.\n * No subprocess spawning, no PyInstaller bundling - just TypeScript code.\n * \n * ARCHITECTURE OVERVIEW:\n * =====================\n * \n * 1. BotFacade (this file) - Orchestrates all components\n * 2. LinkedInAuthenticator - Handles manual login flow\n * 3. LinkedInJobManager - Searches jobs and coordinates applications\n * 4. LinkedInEasyApplier - Fills out Easy Apply forms\n * 5. GPTAnswerer - AI-powered form response generation\n * 6. StatusReporter - Real-time status updates to Electron UI\n * \n * USAGE:\n * ======\n * \n * ```typescript\n * import { LinkedInBot } from './bot';\n * \n * const bot = new LinkedInBot();\n * await bot.initialize({ token, apiUrl, configPath, resumePath });\n * await bot.start(browserWindow);\n * ```\n */\n\nimport { BrowserWindow } from 'electron';\nimport type { Browser, BrowserContext, Page } from 'playwright-core';\nimport { chromium } from 'playwright-core';\nimport * as path from 'path';\nimport * as os from 'os';\nimport type { ChildProcess } from 'child_process';\n\nimport type { JobSearchConfig, Resume } from './types';\nimport { loadAndValidateConfig } from './core/config-validator';\nimport { loadResume } from './models/resume';\nimport { LinkedInAuthenticator } from './linkedin/authenticator';\nimport { LinkedInJobManager } from './linkedin/job-manager';\nimport { GPTAnswerer } from './ai/gpt-answerer';\nimport { StatusReporter, statusReporter } from './utils/status-reporter';\nimport { createLogger, logger } from './utils/logger';\nimport { getDataFolderPath, getChromiumPath } from './utils/paths';\n\nconst log = createLogger('LinkedInBot');\n\n// Bot version - should match package.json\nconst BOT_VERSION = '2.0.0';\n\n/**\n * Bot initialization options\n */\nexport interface BotOptions {\n  /** Backend API token (64-char hex) */\n  token: string;\n  /** Backend API URL */\n  apiUrl: string;\n  /** Path to config.yaml */\n  configPath?: string;\n  /** Path to resume.yaml */\n  resumePath?: string;\n  /** Enable verbose logging */\n  verbose?: boolean;\n  /** Chromium executable path (provided by Electron) */\n  chromiumPath?: string;\n  /** User data directory for browser profile */\n  userDataDir?: string;\n}\n\n/**\n * LinkedInBot - Main bot facade class\n * \n * Orchestrates all bot components and provides a clean interface\n * for starting and stopping the job application process.\n * \n * This is a \"Facade Pattern\" - it simplifies complex subsystem interactions\n * into a single, easy-to-use interface.\n */\nexport class LinkedInBot {\n  // Component instances\n  private browser: Browser | null = null;\n  private context: BrowserContext | null = null;\n  private page: Page | null = null;\n  private authenticator: LinkedInAuthenticator | null = null;\n  private jobManager: LinkedInJobManager | null = null;\n  private gptAnswerer: GPTAnswerer | null = null;\n  \n  // Configuration\n  private config: JobSearchConfig | null = null;\n  private resume: Resume | null = null;\n  private options: BotOptions | null = null;\n  \n  // State tracking\n  private isRunning = false;\n  private shouldStop = false;\n  private browserPid: number | null = null;\n  private startedAt: number | null = null;\n\n  /**\n   * Initialize the bot with configuration\n   * \n   * @param options - Bot configuration options\n   */\n  async initialize(options: BotOptions): Promise<void> {\n    log.info('Initializing LinkedIn Bot...');\n    this.options = options;\n\n    // Validate token format (64 hex characters)\n    if (!this.validateToken(options.token)) {\n      throw new Error('Invalid token format. Expected 64 hexadecimal characters.');\n    }\n\n    // Configure logging level\n    if (options.verbose) {\n      logger.setLevel('debug');\n      log.info('Verbose logging enabled');\n    }\n\n    // Load configuration\n    const dataFolder = getDataFolderPath();\n    const configPath = options.configPath || path.join(dataFolder, 'config.yaml');\n    const resumePath = options.resumePath || path.join(dataFolder, 'resume.yaml');\n\n    log.info(`Loading config from: ${configPath}`);\n    this.config = loadAndValidateConfig(configPath);\n\n    log.info(`Loading resume from: ${resumePath}`);\n    this.resume = loadResume(resumePath);\n\n    // Initialize GPT Answerer\n    log.info('Initializing GPT Answerer...');\n    this.gptAnswerer = new GPTAnswerer(\n      options.token,\n      options.apiUrl,\n      statusReporter\n    );\n    this.gptAnswerer.setResume(this.resume);\n\n    log.info('\u2705 Bot initialized successfully');\n  }\n\n  /**\n   * Start the bot with the given browser window\n   * \n   * @param mainWindow - Electron BrowserWindow for status updates\n   */\n  async start(mainWindow: BrowserWindow): Promise<void> {\n    if (!this.options || !this.config || !this.resume || !this.gptAnswerer) {\n      throw new Error('Bot not initialized. Call initialize() first.');\n    }\n\n    if (this.isRunning) {\n      throw new Error('Bot is already running');\n    }\n\n    this.isRunning = true;\n    this.shouldStop = false;\n\n    // Set up status reporter\n    statusReporter.setMainWindow(mainWindow);\n    statusReporter.startSession(BOT_VERSION, os.platform());\n\n    try {\n      // Launch browser\n      log.info('Launching browser...');\n      await this.launchBrowser();\n\n      if (!this.page) {\n        throw new Error('Failed to create browser page');\n      }\n\n      // Initialize components\n      this.authenticator = new LinkedInAuthenticator(this.page, statusReporter);\n      this.jobManager = new LinkedInJobManager(this.page, statusReporter);\n      this.jobManager.setGptAnswerer(this.gptAnswerer);\n      this.jobManager.setParameters(this.config);\n\n      // Start login\n      log.info('Starting LinkedIn authentication...');\n      statusReporter.sendHeartbeat('linkedin_login');\n      await this.authenticator.start();\n      statusReporter.sendHeartbeat('linkedin_login_done');\n\n      // Check if stopped during login\n      if (this.shouldStop) {\n        log.info('Bot stopped during login');\n        return;\n      }\n\n      // Start job applications\n      log.info('Starting job application process...');\n      await this.jobManager.startApplying();\n\n      // Report success\n      statusReporter.sendHeartbeat('finalizing');\n      statusReporter.completeSession(true);\n      log.info('\u2705 Bot completed successfully');\n\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      log.error('Bot error: ' + errorMessage);\n      statusReporter.completeSession(false, errorMessage);\n      throw error;\n\n    } finally {\n      this.isRunning = false;\n      await this.cleanup();\n    }\n  }\n\n  /**\n   * Stop the bot gracefully\n   */\n  async stop(): Promise<void> {\n    log.info('Stopping bot...');\n    this.shouldStop = true;\n    statusReporter.markStopped();\n    await this.cleanup();\n  }\n\n  /**\n   * Check if the bot is currently running\n   */\n  get running(): boolean {\n    return this.isRunning;\n  }\n\n  /**\n   * Get the browser process ID (for force kill)\n   */\n  getBrowserPid(): number | null {\n    return this.browserPid;\n  }\n\n  /**\n   * Get bot status information\n   */\n  getStatus(): { running: boolean; pid: number | null; startedAt: number | null } {\n    return {\n      running: this.isRunning,\n      pid: this.browserPid,\n      startedAt: this.startedAt,\n    };\n  }\n\n  /**\n   * Get current session stats from StatusReporter\n   * Used by getBotStatus() to restore stats on page reload\n   */\n  getStats(): { jobs_found: number; jobs_applied: number; jobs_failed: number; credits_used: number } | null {\n    const stats = statusReporter.getStats();\n    return {\n      jobs_found: stats.jobsFound,\n      jobs_applied: stats.jobsApplied,\n      jobs_failed: stats.jobsFailed,\n      credits_used: stats.creditsUsed,\n    };\n  }\n\n  /**\n   * Launch Playwright browser with persistent profile\n   */\n  private async launchBrowser(): Promise<void> {\n    const chromiumPath = this.options?.chromiumPath || getChromiumPath();\n    const userDataDir = this.options?.userDataDir || path.join(getDataFolderPath(), '..', 'chrome_profile');\n\n    log.info(`Chromium path: ${chromiumPath}`);\n    log.info(`User data dir: ${userDataDir}`);\n\n    // Launch persistent context (keeps login session)\n    this.context = await chromium.launchPersistentContext(userDataDir, {\n      executablePath: chromiumPath,\n      headless: false, // Must be visible for manual login\n      viewport: { width: 1280, height: 800 },\n      userAgent: 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',\n      args: [\n        '--disable-blink-features=AutomationControlled',\n        '--disable-infobars',\n        '--no-sandbox',\n      ],\n    });\n\n    // Extract browser PID for force-kill capability\n    // Playwright stores the browser process internally\n    try {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const browserServer = (this.context as any)._browser;\n      const browserProcess: ChildProcess | undefined = browserServer?._browserProcess;\n      if (browserProcess?.pid) {\n        this.browserPid = browserProcess.pid;\n        this.startedAt = Date.now();\n        log.info(`Browser PID: ${this.browserPid}`);\n      } else {\n        log.warn('Could not extract browser PID from Playwright context');\n      }\n    } catch (e) {\n      log.warn(`Failed to get browser PID: ${e}`);\n    }\n\n    // Get the first page or create one\n    const pages = this.context.pages();\n    this.page = pages.length > 0 ? pages[0] : await this.context.newPage();\n\n    log.info('\u2705 Browser launched');\n  }\n\n  /**\n   * Clean up browser resources\n   */\n  private async cleanup(): Promise<void> {\n    log.info('Cleaning up...');\n\n    try {\n      if (this.context) {\n        await this.context.close();\n        this.context = null;\n      }\n      if (this.browser) {\n        await this.browser.close();\n        this.browser = null;\n      }\n      this.page = null;\n      this.browserPid = null;\n      this.startedAt = null;\n    } catch (error) {\n      log.error('Cleanup error', error as Error);\n    }\n  }\n\n  /**\n   * Validate token format (64 hex characters)\n   */\n  private validateToken(token: string): boolean {\n    if (token.length !== 64) return false;\n    return /^[0-9a-fA-F]+$/.test(token);\n  }\n}\n\n// Export singleton for convenience\nexport const linkedInBot = new LinkedInBot();\n\n// Re-export all types and utilities for external use\nexport * from './types';\nexport { loadAndValidateConfig, ConfigError } from './core/config-validator';\nexport { loadResume, parseResumeYaml } from './models/resume';\nexport { LinkedInAuthenticator } from './linkedin/authenticator';\nexport { LinkedInJobManager } from './linkedin/job-manager';\nexport { GPTAnswerer } from './ai/gpt-answerer';\nexport { StatusReporter, statusReporter } from './utils/status-reporter';\nexport { createLogger, logger } from './utils/logger';\n"],
  "mappings": "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",
  "names": ["loadAndValidateConfig", "loadResume", "LinkedInAuthenticator", "LinkedInJobManager", "GPTAnswerer", "StatusReporter", "statusReporter", "createLogger", "logger"]
}
