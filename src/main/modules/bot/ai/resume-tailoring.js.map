{
  "version": 3,
  "sources": ["resume-tailoring.ts"],
  "sourcesContent": ["/**\n * Resume Tailoring Pipeline\n * \n * Implements the 4-stage resume tailoring pipeline that matches the Python bot.\n * Extracted from gpt-answerer.ts for better modularity.\n * \n * Pipeline stages:\n * 1. Extract keywords from job description\n * 2. Score all resume items by relevance  \n * 3. Filter top items with dynamic thresholds\n * 4. Optimize keywords in filtered resume\n */\n\nimport { createLogger } from '../utils/logger';\nimport { ResumeSectionScorer } from '../models/resume-scorer';\nimport type { GPTAnswerer } from './gpt-answerer';\n\nconst log = createLogger('ResumeTailoring');\n\nexport interface TailoringResult {\n  success: boolean;\n  tailoredYaml: string;\n  metrics?: {\n    stage1Duration: number;\n    stage2Duration: number;\n    stage3Duration: number;\n    stage4Duration: number;\n    totalDuration: number;\n    itemsSelected: number;\n    scoreRange: string;\n  };\n  error?: string;\n}\n\nexport interface KeywordsDict {\n  technical_skills: string[];\n  soft_skills: string[];\n  domain_terms: string[];\n  action_verbs: string[];\n}\n\n/**\n * Execute the 4-stage resume tailoring pipeline\n * \n * @param gptAnswerer - GPT answerer instance for LLM calls\n * @param jobDescription - Job description text\n * @param baseResumeYaml - Base resume in YAML format\n * @returns Tailored resume YAML or original on failure\n */\nexport async function tailorResumePipeline(\n  gptAnswerer: GPTAnswerer,\n  jobDescription: string,\n  baseResumeYaml: string\n): Promise<TailoringResult> {\n  log.info('=== Starting 4-Stage Resume Tailoring Pipeline ===');\n  log.debug(`Job description length: ${jobDescription.length} chars`);\n  log.debug(`Base resume YAML size: ${baseResumeYaml.length} bytes`);\n\n  try {\n    // === STAGE 1: Extract keywords from job description ===\n    const stage1Start = Date.now();\n    log.info('\uD83D\uDD0D Stage 1: Extracting keywords from job description');\n    \n    const keywordsJson = await gptAnswerer.extractJobKeywords(jobDescription);\n    const keywordsDict = JSON.parse(keywordsJson) as KeywordsDict;\n    \n    const stage1Duration = (Date.now() - stage1Start) / 1000;\n    log.info(`\u2713 Stage 1 completed in ${stage1Duration.toFixed(2)}s`);\n    \n    const totalKeywords = Object.values(keywordsDict).reduce(\n      (sum, arr) => sum + (Array.isArray(arr) ? arr.length : 0), 0\n    );\n    log.info(`Extracted ${totalKeywords} keywords: ${keywordsDict.technical_skills?.length || 0} technical, ${keywordsDict.soft_skills?.length || 0} soft skills`);\n\n    // === STAGE 2: Score all resume items ===\n    const stage2Start = Date.now();\n    log.info('\uD83C\uDFAF Stage 2: Scoring resume items by relevance');\n    \n    const scoresJson = await gptAnswerer.scoreResumeForJob(jobDescription, baseResumeYaml);\n    \n    const stage2Duration = (Date.now() - stage2Start) / 1000;\n    log.info(`\u2713 Stage 2 completed in ${stage2Duration.toFixed(2)}s`);\n\n    // === STAGE 3: Filter top items ===\n    const stage3Start = Date.now();\n    log.info('\uD83D\uDCCA Stage 3: Filtering top items with special rules');\n    \n    const scorer = new ResumeSectionScorer(baseResumeYaml, jobDescription);\n    scorer.parseScoresJson(scoresJson);\n    scorer.convertToScoredItems(scorer.scoresDict!);\n    \n    // Apply enhanced filtering (matches Python's settings)\n    const { items: selectedItems, metrics } = scorer.filterTopItems({\n      minScore: 40,\n      minItems: 10,\n      maxItems: 15,\n      minWorkItems: 2,\n      maxEducationItems: 5,\n      educationMinScore: 50,\n    });\n    \n    // Select top skills\n    const selectedSkills = scorer.getTopSkills(20);\n    \n    // Build filtered YAML\n    const filteredConfig = scorer.filterResumeYaml(selectedItems, selectedSkills);\n    \n    const stage3Duration = (Date.now() - stage3Start) / 1000;\n    log.info(`\u2713 Stage 3 completed in ${stage3Duration.toFixed(2)}s`);\n    log.info(`Selected: ${metrics.itemsSelected} items (scores: ${metrics.minScore}-${metrics.maxScore}, avg: ${metrics.avgScore.toFixed(1)})`);\n    log.info(`By category: ${JSON.stringify(metrics.selectionByCategory)}`);\n\n    // === STAGE 4: Optimize keywords ===\n    const stage4Start = Date.now();\n    log.info('\u270D\uFE0F  Stage 4: Optimizing keywords and descriptions with target terms');\n    \n    const keywordsFormatted = formatKeywords(keywordsDict);\n    const optimizedConfig = await gptAnswerer.optimizeResumeKeywords(\n      jobDescription,\n      filteredConfig,\n      keywordsFormatted\n    );\n    \n    const stage4Duration = (Date.now() - stage4Start) / 1000;\n    log.info(`\u2713 Stage 4 completed in ${stage4Duration.toFixed(2)}s`);\n    \n    const totalDuration = stage1Duration + stage2Duration + stage3Duration + stage4Duration;\n    log.info(`=== Pipeline completed in ${totalDuration.toFixed(2)}s (S1: ${stage1Duration.toFixed(1)}s | S2: ${stage2Duration.toFixed(1)}s | S3: ${stage3Duration.toFixed(1)}s | S4: ${stage4Duration.toFixed(1)}s) ===`);\n    \n    return {\n      success: true,\n      tailoredYaml: optimizedConfig,\n      metrics: {\n        stage1Duration,\n        stage2Duration,\n        stage3Duration,\n        stage4Duration,\n        totalDuration,\n        itemsSelected: metrics.itemsSelected,\n        scoreRange: `${metrics.minScore}-${metrics.maxScore}`,\n      },\n    };\n    \n  } catch (error) {\n    log.warn(`Pipeline failed: ${error}`);\n    return {\n      success: false,\n      tailoredYaml: baseResumeYaml,\n      error: String(error),\n    };\n  }\n}\n\n/**\n * Format keywords dictionary for prompt\n */\nfunction formatKeywords(keywordsDict: KeywordsDict): string {\n  return `Technical Skills: ${keywordsDict.technical_skills?.join(', ') || ''}\nSoft Skills: ${keywordsDict.soft_skills?.join(', ') || ''}\nDomain Terms: ${keywordsDict.domain_terms?.join(', ') || ''}\nAction Verbs: ${keywordsDict.action_verbs?.join(', ') || ''}`;\n}\n"],
  "mappings": "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",
  "names": []
}
